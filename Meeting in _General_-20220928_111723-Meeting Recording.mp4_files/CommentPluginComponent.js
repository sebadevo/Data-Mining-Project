(window.webpackJsonp_name_=window.webpackJsonp_name_||[]).push([[146],{200:function(e,t,n){"use strict";var a;n.d(t,"e",function(){return a}),function(e){e.Webcam2Off="Webcam2Off",e.Hamburger="Hamburger",e.Wifi="Wifi",e.ChevronDown="ChevronDown",e.ChevronUp="ChevronUp",e.Edit="Edit",e.Add="Add",e.Cancel="Cancel",e.More="More",e.Settings="Settings",e.Video="Video",e.Mail="Mail",e.People="People",e.Filter="Filter",e.Microphone="Microphone",e.Search="Search",e.Camera="Camera",e.Send="Send",e.SendFill="SendFill",e.FavoriteList="FavoriteList",e.Refresh="Refresh",e.Share="Share",e.FavoriteStar="FavoriteStar",e.FavoriteStarFill="FavoriteStarFill",e.CheckMark="CheckMark",e.BackToWindow="BackToWindow",e.FullScreen="FullScreen",e.Delete="Delete",e.Mute="Mute",e.Volume="Volume",e.Play="Play",e.Pause="Pause",e.ChevronLeft="ChevronLeft",e.ChevronRight="ChevronRight",e.Smile="Emoji2",e.EmojiDisappointed="EmojiDisappointed",e.Globe="Globe",e.Contact="Contact",e.MegaPhone="MegaPhone",e.Trim="Trim",e.Undo="Undo",e.LiveView="RedEye",e.Warning="Warning",e.BrowsePhotos="BrowsePhotos",e.CircleFill="Record",e.Admin="Admin",e.CC="CC",e.Home="Home",e.Recent="Recent",e.View="View",e.Clear="Clear",e.Download="Download",e.Help="Help",e.Upload="Upload",e.OpenInNewWindow="OpenInNewWindow",e.ChromeClose="ChromeClose",e.BlockContact="BlockContact",e.AddFriend="AddFriend",e.Group="Group",e.Comment="Comment",e.Completed="Completed",e.Streaming="Streaming",e.PlaylistMusic="PlaylistMusic",e.Info="Info",e.Webcam2="Webcam2",e.ChevronLeftSmall="ChevronLeftSmall",e.ChevronRightSmall="ChevronRightSmall",e.Volume1="Volume1",e.Volume2="Volume2",e.LockSolid="LockSolid",e.Ribbon="Ribbon",e.LineChart="LineChart",e.Equalizer="Equalizer",e.CircleRing="Record2",e.HelpMirrored="HelpMirrored",e.HomeSolid="HomeSolid",e.Ringer="Ringer",e.AddToPlaylist="AddToShoppingList",e.CirclePlay="MSNVideos",e.Like="Heart",e.Unlike="HeartFill",e.CloudDownload="CloudDownload",e.MicOff="MicOff",e.CloudUpload="CloudUpload",e.Embed="Embed",e.YammerLogo="YammerLogo",e.Hide="Hide",e.Replay="Replay",e.SeekBack10="SeekBack10",e.SeekForward30="SeekForward30",e.PeopleBlock="PeopleBlock",e.ShareiOS="ShareiOS",e.Speech="Speech",e.ScreenPreviewOn="ScreenPreviewOn",e.StatusCircleCheckmark="StatusCircleCheckmark",e.StatusCircleBlock="StatusCircleBlock",e.PIP="PIP",e.TwoKeys="TwoKeys",e.MoreVertical="MoreVertical",e.StreamLogo="StreamLogo",e.VideoOff="VideoOff",e.WebPublish="WebPublish",e.PlaySolid="PlaySolid",e.Leave="Leave",e.RedEyeAdd="RedEyeAdd",e.Hide3="Hide3",e.MicOff2="MicOff2",e.VideoInfo="VideoInfo",e.RemoveFromPlaylist="RemoveFromShoppingList",e.VideoRemove="VideoRemove",e.SheildAlert="SheildAlert",e.DashProgressRing="DashProgressRing",e.StreamDiscover="StreamDiscover",e.VideoCapture="VideoCapture",e.TranscriptSearch="TranscriptSearch",e.VideoInteractive="VideoInteractive",e.SpeechOff="SpeechOff",e.ErrorBadge="ErrorBadge",e.OfficeFormsLogo="OfficeFormsLogo",e.AddStreamChannel="AddStreamChannel",e.SecurityGroup="SecurityGroup",e.World="World",e.Chat="Chat",e.UserRemove="UserRemove",e.Copy="Copy",e.Bug="Bug",e.OpenInNewTab="OpenInNewTab",e.Repair="Repair",e.Down="Down",e.Bold="Bold",e.Italic="Italic",e.Underline="Underline",e.Link="Link",e.ReportIssue="ReportIssue",e.LocalLanguage="LocalLanguage",e.MeetingNotes="MeetingNotes",e.Thumbnail="Thumbnail",e.PersonFeedback="PersonFeedback",e.ThumbsUp="ThumbsUp",e.ThumbsDown="ThumbsDown",e.ThumbsUpFilled="ThumbsUpFilled",e.ThumbsDownFilled="ThumbsDownFilled"}(a||(a={}))},1360:function(e,t,n){"use strict";var a;n.d(t,"e",function(){return a}),function(e){e[e.share=1]="share",e[e.copy=2]="copy",e[e.atMention=3]="atMention",e[e.linkSettings=4]="linkSettings",e[e.manageAccess=5]="manageAccess",e[e.notify=6]="notify",e[e.addPeople=7]="addPeople"}(a||(a={}))},1681:function(e,t,n){"use strict";n.d(t,"e",function(){return b});var a=n(0),i=n(43),r=n.n(i),o=n(201),s=n(3423),c=n(131),d=function(e){return Object(s.t)({tocSpinner:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},shareDialogDiv:{display:"flex",flexFlow:"column nowrap",alignItems:"stretch"},shareAtCurrentTsDiv:{paddingLeft:"16px",paddingTop:"20px",paddingBottom:"0px"},shareSelectionDiv:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},shareSelectionButton:{display:"flex",justifyContent:"center",padding:3},closeIconButton:{root:{marginLeft:"auto",marginTop:"2px",marginRight:"2px"}},shareDialogHeader:[e.fonts.xLarge,{flex:"1 1 auto",display:"flex",fontWeight:c.e.semibold,paddingBottom:"0px",paddingLeft:"16px",paddingRight:"8px",paddingTop:"15px",flexFlow:"row nowrap",justifyContent:"space-between",alignItems:"baseline"}],noDisplay:{display:"none"},inlineDisplay:{display:"inline"},shareDialogCheckbox:{bottom:"0px"}})},l=function(e){var t={playbackOptions:e};return JSON.stringify(t)};function u(){var e=r.a.useState(),t=e[0],n=e[1];return[t,r.a.useCallback(function(e){e&&n(e)},[])]}var f=n(421),p=n(160),m=function(e){var t=e.sharingEndpoint,n=e.telemetryApi,a=e.localization,s=e.onShareStateChanged,c=e.onDismiss,l=e.onGrantAccess,m=e.ignoreWidthChange,_=e.longLivedQoSEvents,h=e.name,b=void 0===h?"shareIframe":h,g=d(Object(o.e)()),v=Object(i.useState)(!1),y=v[0],S=v[1],D=Object(i.useState)(360),I=D[0],x=D[1],C=Object(i.useState)(0),O=C[0],w=C[1],E=u(),A=E[0],L=E[1],k=Object(i.useCallback)(function(e){var a,i,r,o,d=(null==A?void 0:A.contentWindow)||(null===(a=null==A?void 0:A.contentDocument)||void 0===a?void 0:a.defaultView);if(t.startsWith(e.origin)&&A&&d===e.source){var u;try{u=JSON.parse(e.data)}catch(e){return void n.warn("Share message parsing failed",{name:"ShareMessageParsingFailed",isExpected:!1})}var f=u.name;switch(f){case"share_started":case"share_copyLinkClicked":case"share_sendClicked":n.appLogic({name:"".concat(f)}),null==s||s("loading");break;case"share_ready":n.appLogic({name:"".concat(f)}),S(!0),null==s||s("ready"),null===(i=null==_?void 0:_.timeToLoadShareDialogQos)||void 0===i||i.end(),_&&(_.timeToLoadShareDialogQos=void 0);break;case"share_resize":n.appLogic({name:"".concat(f),message:"requestedWidth: ".concat(u.width,", height: ").concat(u.height,", ignoreWidthChange: ").concat(m)}),m||x(u.width),w(u.height);break;case"share_grantAccessCompleted":n.appLogic({name:"".concat(f)}),l&&l();break;case"share_dismiss":n.appLogic({name:"".concat(f)}),null===(r=null==_?void 0:_.timeToLoadShareDialogQos)||void 0===r||r.endUnexpectedError("Warning","share_dismiss before share_ready"),_&&(_.timeToLoadShareDialogQos=void 0),c&&c(),S(!1);break;case"share_error":n.warn(u.debugErrorMessage,{name:"share_error",isExpected:!1}),null==s||s("error"),null===(o=null==_?void 0:_.timeToLoadShareDialogQos)||void 0===o||o.endUnexpectedError("Fatal","share_error"),_&&(_.timeToLoadShareDialogQos=void 0);break;case"share_completed":n.appLogic({name:"".concat(f)}),null==s||s("completed");break;default:n.appLogic({name:"".concat(f)})}}},[A,t,n,b,m,_,c,l,s]);return Object(i.useEffect)(function(){return window.addEventListener("message",k),function(){window.removeEventListener("message",k)}},[k]),r.a.createElement("div",null,!y&&r.a.createElement(f.e,{label:a.getString("ShareDialogLoading"),size:p.e.large,className:g.tocSpinner}),r.a.createElement("div",null,r.a.createElement("iframe",{tabIndex:0,ref:L,id:b,name:b,src:"#",frameBorder:"0",style:{width:I,height:O,visibility:y?"visible":"hidden"}})))},_=function(e){var t=e.listId,n=e.listItemId,a=e.accessToken,s=e.webAbsoluteUrl,c=e.sharingEndpoint,l=e.nav,f=e.mode,p=e.onDismiss,_=e.onGrantAccess,h=e.telemetryApi,b=e.localization,g=e.shareQos,v=e.sharingScenario,y=e.defaultRecipients,S=d(Object(o.e)()),D=u(),I=D[0],x=D[1],C=u(),O=C[0],w=C[1],E=Object(o.e)().palette,A="ShareIframe".concat(null!=v?v:"");return Object(i.useEffect)(function(){I&&O&&E&&(t&&n&&s&&a?function(e){if(O&&I){var i={authToken:a,webAbsoluteUrl:s,clientId:"onePlayer",mode:f,listItemId:n,listId:t,theme:{palette:E},hostOptions:{showCloseButton:!0,canGrantEditPermissions:!1},accessChecked:!0,defaultRecipients:y};l&&(i.navId=l),O.value=JSON.stringify(i),I.action=c,I.target=e,I.submit()}}(A):h.appLogic({name:"missingShareMetadata:listId=".concat(t?"available":"missing",",listItemId=").concat(n?"available":"missing",",accessToken=").concat(a?"available":"missing",",webAbsoluteUrl=").concat(s?"available":"missing")}))},[I,O,E,t,n,s,a,h]),r.a.createElement("div",{className:S.shareDialogDiv},r.a.createElement("form",{ref:x,method:"post",className:S.noDisplay},r.a.createElement("input",{ref:w,type:"text",name:"context"})),r.a.createElement(m,{sharingEndpoint:c,longLivedQoSEvents:g,telemetryApi:h,localization:b,onDismiss:p,onGrantAccess:_,ignoreWidthChange:!0,name:A}))},h=n(558);function b(e){var t=e.mode,n=e.sharePointLocator,i=e.accessToken,o=e.telemetryApi,s=e.localization,c=e.showModal,d=e.defaultRecipients,u=e.shareQos,f=e.playbackOptions,p=e.onDismiss,m=e.onGrantAccess;return Object(a.t)(this,void 0,void 0,function(){var e,b,g;return Object(a.i)(this,function(a){switch(a.label){case 0:return e=null,b=function(){var e;null===(e=null==u?void 0:u.timeToLoadShareDialogQos)||void 0===e||e.endExpectedError("Warning",Object(h.n)("User closed Share Dialog before share_ready"))},g=function(){e&&e.isValid&&e.dismiss(),b()},[4,c({getContent:function(){return r.a.createElement(_,{listId:n.listId,listItemId:n.listItemId,accessToken:i,webAbsoluteUrl:n.siteUrl,sharingEndpoint:(e=s.locale.value,"https://www.odwebp.svc.ms/share"+(e?"?smkt=".concat(e):"")),nav:f?l(f):void 0,onDismiss:g,onGrantAccess:m,telemetryApi:o,localization:s,shareQos:u,mode:t,defaultRecipients:d});var e},onDismissHandler:function(){p&&p(),b()}})];case 1:return e=a.sent(),[2]}})})}},2376:function(e,t,n){var a={"./af-ZA/comment-pane-strings.json":[2737,293],"./am-ET/comment-pane-strings.json":[2738,294],"./ar-SA/comment-pane-strings.json":[2739,295],"./as-IN/comment-pane-strings.json":[2740,297],"./az-Latn-AZ/comment-pane-strings.json":[2741,298],"./be-BY/comment-pane-strings.json":[2742,300],"./bg-BG/comment-pane-strings.json":[2743,301],"./bn-BD/comment-pane-strings.json":[2744,303],"./bn-IN/comment-pane-strings.json":[2745,304],"./bs-Latn-BA/comment-pane-strings.json":[2746,305],"./ca-ES/comment-pane-strings.json":[2747,308],"./ca-Es-VALENCIA/comment-pane-strings.json":[2748,309],"./chr-Cher-US/comment-pane-strings.json":[2749,311],"./cs-CZ/comment-pane-strings.json":[2750,312],"./cy-GB/comment-pane-strings.json":[2751,314],"./da-DK/comment-pane-strings.json":[2752,316],"./de-DE/comment-pane-strings.json":[2753,318],"./el-GR/comment-pane-strings.json":[2754,320],"./en-GB/comment-pane-strings.json":[2755,322],"./en-US/comment-pane-strings.json":[2756,323],"./es-ES/comment-pane-strings.json":[2757,326],"./es-MX/comment-pane-strings.json":[2758,327],"./et-EE/comment-pane-strings.json":[2759,330],"./eu-ES/comment-pane-strings.json":[2760,332],"./fa-IR/comment-pane-strings.json":[2761,334],"./fi-FI/comment-pane-strings.json":[2762,335],"./fil-PH/comment-pane-strings.json":[2763,337],"./fr-CA/comment-pane-strings.json":[2764,345],"./fr-FR/comment-pane-strings.json":[2765,346],"./ga-IE/comment-pane-strings.json":[2766,349],"./gd-gb/comment-pane-strings.json":[2767,351],"./gl-ES/comment-pane-strings.json":[2768,352],"./gu-IN/comment-pane-strings.json":[2769,354],"./ha-Latn-NG/comment-pane-strings.json":[2770,355],"./he-IL/comment-pane-strings.json":[2771,356],"./hi-IN/comment-pane-strings.json":[2772,358],"./hr-HR/comment-pane-strings.json":[2773,446],"./hu-HU/comment-pane-strings.json":[2774,448],"./hy-AM/comment-pane-strings.json":[2775,450],"./id-ID/comment-pane-strings.json":[2776,451],"./is-IS/comment-pane-strings.json":[2777,453],"./it-IT/comment-pane-strings.json":[2778,455],"./ja-JP/comment-pane-strings.json":[2779,457],"./ka-GE/comment-pane-strings.json":[2780,459],"./kk-KZ/comment-pane-strings.json":[2781,462],"./km-KH/comment-pane-strings.json":[2782,464],"./kn-IN/comment-pane-strings.json":[2783,465],"./ko-KR/comment-pane-strings.json":[2784,466],"./kok-IN/comment-pane-strings.json":[2785,468],"./ky-KG/comment-pane-strings.json":[2786,469],"./lb-LU/comment-pane-strings.json":[2787,470],"./lo-LA/comment-pane-strings.json":[2788,471],"./lt-LT/comment-pane-strings.json":[2789,472],"./lv-LV/comment-pane-strings.json":[2790,474],"./mi-NZ/comment-pane-strings.json":[2791,478],"./mk-MK/comment-pane-strings.json":[2792,479],"./ml-IN/comment-pane-strings.json":[2793,481],"./mn-MN/comment-pane-strings.json":[2794,482],"./mr-IN/comment-pane-strings.json":[2795,483],"./ms-MY/comment-pane-strings.json":[2796,484],"./mt-MT/comment-pane-strings.json":[2797,486],"./nb-NO/comment-pane-strings.json":[2798,489],"./ne-NP/comment-pane-strings.json":[2799,492],"./nl-NL/comment-pane-strings.json":[2800,494],"./nn-NO/comment-pane-strings.json":[2801,496],"./or-IN/comment-pane-strings.json":[2802,508],"./pa-IN/comment-pane-strings.json":[2803,570],"./pl-PL/comment-pane-strings.json":[2804,573],"./prs-AF/comment-pane-strings.json":[2805,591],"./pt-BR/comment-pane-strings.json":[2806,594],"./pt-PT/comment-pane-strings.json":[2807,595],"./qps-ploc/comment-pane-strings.json":[2808,598],"./qps-ploca/comment-pane-strings.json":[2809,599],"./qps-plocm/comment-pane-strings.json":[2810,600],"./quz-PE/comment-pane-strings.json":[2811,601],"./ro-RO/comment-pane-strings.json":[2812,603],"./ru-RU/comment-pane-strings.json":[2813,605],"./sd-Arab-PK/comment-pane-strings.json":[2814,608],"./si-LK/comment-pane-strings.json":[2815,610],"./sk-SK/comment-pane-strings.json":[2816,611],"./sl-SI/comment-pane-strings.json":[2817,613],"./sq-AL/comment-pane-strings.json":[2818,615],"./sr-Cyrl-BA/comment-pane-strings.json":[2819,617],"./sr-Cyrl-RS/comment-pane-strings.json":[2820,618],"./sr-Latn-RS/comment-pane-strings.json":[2821,619],"./sv-SE/comment-pane-strings.json":[2822,623],"./sw-KE/comment-pane-strings.json":[2823,625],"./ta-IN/comment-pane-strings.json":[2824,626],"./te-IN/comment-pane-strings.json":[2825,627],"./th-TH/comment-pane-strings.json":[2826,629],"./tk-TM/comment-pane-strings.json":[2827,631],"./tr-TR/comment-pane-strings.json":[2828,632],"./tt-RU/comment-pane-strings.json":[2829,634],"./ug-CN/comment-pane-strings.json":[2830,636],"./uk-UA/comment-pane-strings.json":[2831,638],"./ur-PK/comment-pane-strings.json":[2832,640],"./uz-Latn-UZ/comment-pane-strings.json":[2833,641],"./vi-VN/comment-pane-strings.json":[2834,719],"./zh-CN/comment-pane-strings.json":[2835,845],"./zh-TW/comment-pane-strings.json":[2836,846]};function i(e){if(!n.o(a,e))return Promise.resolve().then(function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=a[e],i=t[0];return n.e(t[1]).then(function(){return n.t(i,3)})}i.keys=function(){return Object.keys(a)},i.id=2376,e.exports=i},3237:function(e,t,n){"use strict";n.r(t),n.d(t,"Comment",function(){return V}),n.d(t,"getCommentPropsAsync",function(){return qe}),n.d(t,"richCommentsExposedInternalFeatureFlagMap",function(){return Qe}),n.d(t,"FeatureEnablement",function(){return _});var a,i=n(43),r=n.n(i),o=n(317),s=n(0),c=n(1155),d=n(1081),l=n(558),u=n(908),f=n(970),p=n(376),m=n(969);!function(e){e.SingleVideo="SingleVideo",e.EmbedVideo="EmbedVideo"}(a||(a={}));var _,h=n(80),b=Object(h.ee)({pluginPane:[{display:"flex",flexDirection:"column",height:"100%"}],commentListPane:[{overflowY:"auto",overflowX:"clip",height:"100%",margin:"8px 0px 8px 0px"}],itemCell:[{padding:"8px 16px 8px 16px"}],listContainer:[{alignItems:"center",display:"table"}],HeaderBar:[{display:"flex",padding:"0 8px"}],CommandBar:[{display:"flex"}],CommandBarItem:[{height:44}],OverFlowSet:[{marginLeft:"auto"}],OverFlowSetItem:[{height:44,width:48}],Separator:[{padding:0,height:1}],PaneBackground:[{margin:"auto",display:"-webkit-flex",flexDirection:"column"}],PaneBackgroundMessage:[{margin:"auto",marginTop:12,textAlign:"center",width:"260px"}],PaneBackgroundLogo:[{margin:"auto",width:"102px",height:"102px"}],deletePrompt:[{marginLeft:16,marginRight:16}],deleteAllConfirmationText:[{maxWidth:450}],deleteAllPromptStack:[{marginTop:24}],errorState:[{margin:"auto"}],loadingSpinner:[{margin:"auto"}]}),g=function(e){return Object(h.ee)({root:{backgroundColor:e.palette.neutralLighterAlt},rootDisabled:{backgroundColor:e.palette.neutralLighterAlt,color:"".concat(e.palette.neutralTertiary," !important")},menuIcon:{fontSize:"16px"}})},v=n(1700),y=n(741),S=function(e){var t;switch(e.commentError.eventType){case 3:t=e.localization.getString("Comments.Error.CreateFailed");break;case 2:t=e.localization.getString("Comments.Error.ReplyFailed");break;case 4:t=e.localization.getString("Comments.Error.UpdateFailed");break;case 5:t=e.localization.getString("Comments.Error.DeleteFailed");break;case 6:t=e.localization.getString("Comments.Error.DeleteAllFailed");break;case 8:t=e.localization.getString("Comments.Error.DeleteFailedThreadNotFound");break;case 9:t=e.localization.getString("Comments.Error.ReplyFailedThreadNotFound");break;case 10:t=e.localization.getString("Comments.Error.UpdateFailedThreadNotFound");break;case 1:t=e.localization.getString("Comments.Error.LengthLimit");break;case 12:t=e.localization.getString("Comments.Error.EmptyText");break;case 11:t=e.localization.getString("Comments.Error.CommentsDisabled");break;case 14:t=e.localization.getString("Comments.Error.MentionsLimit");break;case 15:t=e.localization.getString("Comments.Error.SelectFailedCommentNotFound");break;case 16:t=e.localization.getString("Comments.Error.LikeFailedCommentNotFound");break;case 17:t=e.localization.getString("Comments.Error.LikeFailed");break;default:t=e.localization.getString("Comments.Error.GeneralError")}return Object(i.useEffect)(function(){e.telemetryApi.appLogic({name:"ErrorMessageBarRendered"})}),r.a.createElement("div",null,r.a.createElement(v.e,{messageBarType:y.e.warning,isMultiline:!0,onDismiss:e.onDismissMessageError,dismissButtonAriaLabel:e.localization.getString("Comments.MessageBarClose.Label")},t))},D=n(1701),I=n(534),x=function(e){var t=Object(i.useState)(null),n=t[0],a=t[1];return Object(i.useEffect)(function(){e.toFocusCommentId===e.commentId&&(setTimeout(function(){return null==n?void 0:n.focus()},100),e.onClearFocusCommentId())},[n,e.toFocusCommentId,e.commentId,e.onClearFocusCommentId]),r.a.createElement("div",{className:b.itemCell},r.a.createElement(e.component,{componentRef:a,resource:{id:e.commentId},accessibilityMetadata:{tabFocusTrapBehavior:I.t.DoNotTrap}}))},C=function(e){var t=e.getThreads();Object(i.useEffect)(function(){e.telemetryApi.appLogic({name:"CommentCardsListRendered",richCommentsThreadNumber:""+t.length}),e.longLivedQosEvents.timeToInteractive&&(e.longLivedQosEvents.timeToInteractive.end(),e.longLivedQosEvents.timeToInteractive=void 0)},[]);var n=t.map(function(e){return e.commentId});return e.draftInfo.draftId&&!e.draftInfo.parentId&&n.unshift(e.draftInfo.draftId),r.a.createElement("div",{id:"commentCardsContainer",className:b.commentListPane,style:{display:!e.isPanelOpen||e.isDeleteAllPromptVisible?"none":"flex"},ref:e.listContainerDivRef},r.a.createElement(D.e,{items:n,onRenderCell:function(t){if(!t)return r.a.createElement(r.a.Fragment,null," ");var n=t+e.commentCardWidth;return r.a.createElement(x,{key:n,component:e.hostableComponentClass,commentId:t,toFocusCommentId:e.toFocusCommentId,onClearFocusCommentId:e.onClearFocusCommentId})},className:b.listContainer,componentRef:e.commentCardListRef}))},O=n(1692),w=n(595),E=n(386),A=function(e){return Object(i.useEffect)(function(){e.telemetryApi.appLogic({name:"DeleteAllCommentsPromptRendered"})}),r.a.createElement("div",{className:b.deletePrompt},r.a.createElement(u.e,{className:b.deleteAllConfirmationText,block:!0},e.localization.getString("Comments.DeleteAllConfirmation")),r.a.createElement(O.e,{horizontal:!0,tokens:{childrenGap:8},className:b.deleteAllPromptStack},r.a.createElement(w.e,{theme:e.theme,onClick:e.onDeleteAll,text:e.localization.getString("Comments.DeleteAllConfirmation.Delete")}),r.a.createElement(E.e,{theme:e.theme,onClick:e.onCancelPrompt,text:e.localization.getString("Comments.DeleteAllConfirmation.Cancel")})))},L=n(704),k=n(1102),M=n(1095),P=n(1098),T=n(1699),U=n(200),F=function(e){var t=[];return e.areCommentsEnabled&&e.isHostTrusted&&e.userCanWrite&&t.push({key:"deleteAll",text:e.localization.getString("Comments.DeleteAll"),onClick:e.onDeleteAllRenderPrompt,disabled:0===e.threadCount,iconProps:{iconName:U.e.Delete}}),r.a.createElement("div",{id:"commentCardsHeader",style:{display:e.isDeleteAllPromptVisible?"none":"block"}},r.a.createElement("div",{className:b.HeaderBar},r.a.createElement(M.e,{id:"newComment",theme:e.theme,key:"newComment",text:e.localization.getString("Comments.NewComment"),onClick:e.onNewComment,disabled:e.isDisabled,iconProps:{iconName:U.e.Add},className:b.CommandBarItem,styles:g(e.theme),componentRef:e.newCommentButtonRef,role:"button"}),t.length>0&&r.a.createElement("div",{className:b.OverFlowSet},r.a.createElement(P.e,{overflowItems:t,onRenderItem:function(e){return r.a.createElement(L.e,{role:"menuitem",onClick:e.onClick},e.name)},onRenderOverflowButton:function(t){var n="richCommentsMoreOptionsToolTip";return r.a.createElement(k.e,{content:e.localization.getString("Comments.MoreOptionsTooltip"),id:n,calloutProps:{gapSpace:0},styles:{root:{display:"inline-block"}}},r.a.createElement(M.e,{id:"moreOptions",role:"button","aria-label":e.localization.getString("Comments.MoreOptions"),"aria-describedby":n,styles:g(e.theme),menuIconProps:{iconName:U.e.More},menuProps:{items:t},className:b.OverFlowSetItem,componentRef:e.moreItemsButtonRef,disabled:e.isDisabled}))},className:b.OverFlowSetItem,role:"menuitem"}))),r.a.createElement(T.e,{className:b.Separator}))},H=Object(i.memo)(function(e){var t,n="video"===e.mediaType.toLowerCase()?"Video":"Audio",a=13===(null===(t=e.commentError)||void 0===t?void 0:t.eventType)?e.localization.getString("Comments.Error.LoadFailed"):e.areCommentsEnabled?e.localization.getString("Comments.BeTheFirstToComment".concat(n)):e.localization.getString("Comments.CommentsAreDisabled".concat(n));return Object(i.useEffect)(function(){var t,n;e.telemetryApi.appLogic({name:13===(null===(t=e.commentError)||void 0===t?void 0:t.eventType)?"ErrorPaneRendered":e.areCommentsEnabled?"NoCommentsPaneRendered":"CommentsDisabledPaneRendered"}),e.longLivedQosEvents.timeToInteractive&&(13===(null===(n=e.commentError)||void 0===n?void 0:n.eventType)?e.longLivedQosEvents.timeToInteractive.endUnexpectedError("Fatal",new Error(Object(l.n)("Failed to load comments"))):e.longLivedQosEvents.timeToInteractive.end(),e.longLivedQosEvents.timeToInteractive=void 0)},[]),r.a.createElement("div",{className:b.PaneBackground},r.a.createElement("svg",{className:b.PaneBackgroundLogo,viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("g",{clipPath:"url(#clip0)"},r.a.createElement("path",{d:"M94.1599 85.689L99.3333 94.0854L87.2799 91.5111C84.5812 93.0028 81.6288 93.9797 78.5733 94.3922C70.7199 95.5126 63.7266 93.234 57.5933 87.5564C54.3812 84.5782 52.1004 80.733 51.0266 76.4856C50.2401 73.4944 49.9584 70.3928 50.1933 67.3088L60.7266 68.8828C61.5134 68.9993 62.3142 68.7984 62.953 68.3245C63.5918 67.8505 64.0164 67.1422 64.1333 66.3552L67.1533 46.0143C69.6425 45.2355 72.2264 44.8002 74.8333 44.7205C79.2094 44.5692 83.5361 45.6854 87.2933 47.935C94.4622 52.2344 98.6066 58.3144 99.7266 66.1751C100.245 69.4232 100.09 72.7431 99.2725 75.929C98.4548 79.1148 96.9915 82.0986 94.9733 84.6953C94.7066 85.0087 94.4399 85.3622 94.1599 85.689Z",fill:e.theme.palette.themeTertiary}),r.a.createElement("path",{d:"M67.96 72.5908C67.6286 72.4602 67.2741 72.3987 66.9181 72.4099C66.5621 72.421 66.2121 72.5047 65.8895 72.6558C65.5669 72.8068 65.2785 73.0221 65.0419 73.2884C64.8053 73.5547 64.6254 73.8665 64.5133 74.2047C64.2747 74.8995 64.3151 75.6599 64.626 76.3256C64.937 76.9912 65.4941 77.51 66.18 77.7727C66.512 77.9023 66.8668 77.9632 67.223 77.9516C67.5791 77.94 67.9293 77.8563 68.2521 77.7054C68.575 77.5545 68.8639 77.3396 69.1013 77.0738C69.3387 76.8079 69.5197 76.4966 69.6333 76.1588C69.8682 75.4629 69.8252 74.7033 69.5133 74.0384C69.2015 73.3735 68.645 72.8549 67.96 72.5908V72.5908Z",fill:e.theme.palette.themeLight}),r.a.createElement("path",{d:"M87.1199 67.9558C87.2422 67.6123 87.2952 67.248 87.2758 66.884C87.2563 66.5199 87.1648 66.1634 87.0065 65.835C86.8568 65.5033 86.6422 65.205 86.3754 64.9576C86.1086 64.7102 85.7951 64.5187 85.4532 64.3944C85.1206 64.2631 84.7646 64.2013 84.4071 64.2128C84.0497 64.2243 83.6984 64.3089 83.3749 64.4613C83.0514 64.6138 82.7625 64.8308 82.526 65.0992C82.2895 65.3676 82.1105 65.6815 81.9999 66.0217C81.7651 66.7175 81.8081 67.4772 82.1199 68.1421C82.4317 68.8069 82.9882 69.3256 83.6732 69.5897C84.0051 69.7201 84.36 69.7813 84.7163 69.7697C85.0727 69.7581 85.4229 69.6739 85.7455 69.5222C86.0682 69.3705 86.3565 69.1545 86.5928 68.8874C86.8291 68.6204 87.0085 68.3079 87.1199 67.9691V67.9558Z",fill:e.theme.palette.themeLight}),r.a.createElement("path",{d:"M76.7134 68.4893C76.382 68.3588 76.0275 68.2972 75.6715 68.3084C75.3155 68.3196 74.9655 68.4033 74.6429 68.5543C74.3203 68.7054 74.0319 68.9206 73.7953 69.1869C73.5587 69.4533 73.3789 69.7651 73.2668 70.1033C73.1429 70.4464 73.0892 70.8109 73.1086 71.1751C73.1281 71.5394 73.2204 71.8961 73.3801 72.2241C73.5307 72.5559 73.7455 72.8546 74.0121 73.103C74.2787 73.3514 74.5919 73.5445 74.9334 73.6713C75.2657 73.8017 75.6211 73.8631 75.9779 73.8515C76.3347 73.84 76.6854 73.7558 77.0086 73.6041C77.3318 73.4525 77.6207 73.2365 77.8576 72.9694C78.0946 72.7023 78.2746 72.3897 78.3868 72.0507C78.6213 71.3557 78.5781 70.597 78.2662 69.9333C77.9543 69.2695 77.3979 68.7521 76.7134 68.4893V68.4893Z",fill:e.theme.palette.themeLight}),r.a.createElement("path",{d:"M71.5066 16.7701L67.1533 46.0143C62.5797 47.559 58.5475 50.3885 55.5387 54.1648C52.5299 57.9411 50.6718 62.5043 50.1866 67.3088L38.1866 65.5215L33.2667 64.7879L21.3333 77.4526L22.9533 63.254L2.55999 60.2196C1.77328 60.1026 1.0652 59.6779 0.591404 59.0389C0.117605 58.3998 -0.0831325 57.5987 0.033321 56.8116L7.41332 7.22659C7.53024 6.43959 7.95476 5.73125 8.59358 5.25727C9.2324 4.7833 10.0332 4.58249 10.82 4.69898L68.98 13.3689C69.7654 13.4859 70.4723 13.9096 70.9459 14.5472C71.4195 15.1847 71.6212 15.9841 71.5066 16.7701V16.7701Z",fill:e.theme.palette.neutralLight}),r.a.createElement("path",{d:"M27.4001 36.8375C27.2986 37.5455 26.9545 38.1962 26.4267 38.6786C25.8988 39.1611 25.22 39.4452 24.506 39.4826C23.792 39.5199 23.0872 39.3082 22.5119 38.8835C21.9367 38.4588 21.5266 37.8476 21.3518 37.1541C21.1769 36.4606 21.2482 35.7279 21.5533 35.0811C21.8585 34.4343 22.3786 33.9135 23.0249 33.6077C23.6712 33.3019 24.4036 33.23 25.097 33.4043C25.7903 33.5786 26.4018 33.9882 26.8268 34.5634C27.0728 34.883 27.2506 35.2498 27.3493 35.6409C27.4479 36.0321 27.4652 36.4394 27.4001 36.8375V36.8375ZM38.2334 38.4515C38.1319 39.1594 37.7878 39.8102 37.26 40.2926C36.7322 40.775 36.0533 41.0591 35.3393 41.0965C34.6253 41.1339 33.9205 40.9221 33.3453 40.4975C32.77 40.0728 32.3599 39.4615 32.1851 38.768C32.0103 38.0745 32.0815 37.3418 32.3867 36.695C32.6918 36.0482 33.2119 35.5274 33.8582 35.2216C34.5045 34.9158 35.2369 34.8439 35.9303 35.0182C36.6237 35.1925 37.2351 35.6022 37.6601 36.1773C37.9065 36.4967 38.0845 36.8635 38.1832 37.2547C38.2818 37.646 38.2989 38.0533 38.2334 38.4515V38.4515ZM49.0934 40.0654C48.9911 40.7697 48.6478 41.4166 48.1219 41.8959C47.5961 42.3752 46.9203 42.6572 46.2099 42.6937C45.4994 42.7303 44.7983 42.5191 44.2261 42.0963C43.6539 41.6735 43.246 41.0652 43.072 40.3751C42.8981 39.6851 42.9688 38.956 43.2721 38.3123C43.5755 37.6686 44.0926 37.1501 44.7354 36.8452C45.3782 36.5404 46.1069 36.468 46.797 36.6405C47.4872 36.813 48.0962 37.2197 48.5201 37.7912C48.7661 38.1109 48.944 38.4776 49.0426 38.8688C49.1412 39.26 49.1585 39.6673 49.0934 40.0654V40.0654Z",fill:e.theme.palette.neutralTertiaryAlt}),r.a.createElement("path",{d:"M64.1268 66.3552L67.1534 46.0143C62.5785 47.5568 58.5449 50.3857 55.5358 54.1624C52.5267 57.9391 50.6696 62.5035 50.1868 67.3088L60.7201 68.8761C61.1093 68.9347 61.5062 68.916 61.8882 68.821C62.2702 68.726 62.6297 68.5566 62.9461 68.3224C63.2625 68.0883 63.5297 67.794 63.7323 67.4564C63.9349 67.1188 64.0689 66.7446 64.1268 66.3552Z",fill:e.theme.palette.themeTertiary}),r.a.createElement("path",{d:"M46.5133 36.5842C45.8099 36.4756 45.0905 36.6147 44.4781 36.9777C43.8658 37.3406 43.3983 37.905 43.1556 38.5744C42.9129 39.2437 42.91 39.9766 43.1474 40.6479C43.3847 41.3192 43.8476 41.8873 44.4571 42.2552C45.0666 42.623 45.7848 42.7678 46.4891 42.6649C47.1934 42.5619 47.8402 42.2176 48.3189 41.6907C48.7977 41.1638 49.0788 40.487 49.1143 39.7758C49.1497 39.0647 48.9373 38.3632 48.5133 37.7913C48.2804 37.4638 47.9827 37.1876 47.6386 36.98C47.2946 36.7723 46.9116 36.6376 46.5133 36.5842V36.5842Z",fill:e.theme.palette.neutralLight}),r.a.createElement("path",{d:"M46.5133 36.5842C45.8099 36.4756 45.0905 36.6147 44.4781 36.9777C43.8658 37.3406 43.3983 37.905 43.1556 38.5744C42.9129 39.2437 42.91 39.9766 43.1474 40.6479C43.3847 41.3192 43.8476 41.8873 44.4571 42.2552C45.0666 42.623 45.7848 42.7678 46.4891 42.6649C47.1934 42.5619 47.8402 42.2176 48.3189 41.6907C48.7977 41.1638 49.0788 40.487 49.1143 39.7758C49.1497 39.0647 48.9373 38.3632 48.5133 37.7913C48.2804 37.4638 47.9827 37.1876 47.6386 36.98C47.2946 36.7723 46.9116 36.6376 46.5133 36.5842Z",fill:e.theme.palette.neutralTertiaryAlt}),r.a.createElement("path",{d:"M24.82 33.3429C24.1135 33.2312 23.3903 33.3685 22.7738 33.7311C22.1573 34.0938 21.6858 34.6594 21.4399 35.3312C21.194 36.003 21.1889 36.7395 21.4256 37.4146C21.6622 38.0898 22.1259 38.6618 22.7374 39.0329C23.3488 39.4039 24.0702 39.5511 24.7781 39.4492C25.486 39.3473 26.1365 39.0026 26.6186 38.4741C27.1006 37.9456 27.3842 37.266 27.421 36.5515C27.4577 35.837 27.2453 35.1319 26.82 34.5567C26.5865 34.229 26.2888 33.9524 25.9449 33.7437C25.6011 33.5351 25.2183 33.3987 24.82 33.3429Z",fill:e.theme.palette.neutralTertiaryAlt})),r.a.createElement("defs",null,r.a.createElement("clipPath",{id:"clip0"},r.a.createElement("rect",{width:"100",height:"100",fill:"white"})))),r.a.createElement("div",{className:b.PaneBackgroundMessage},r.a.createElement(u.e,{block:!0},a)))}),R=function(e){var t=e.pluginPaneDivRef;return Object(i.useEffect)(function(){var e;null===(e=t.current)||void 0===e||e.focus()},[t.current]),r.a.createElement("div",{ref:e.pluginPaneDivRef,className:b.pluginPane,role:"region","aria-labelledby":"navigationPanelHeader"},r.a.createElement(F,{telemetryApi:e.telemetryApi,localization:e.localization,theme:e.theme,userCanWrite:e.userCanWrite,isHostTrusted:e.isHostTrusted,isDeleteAllPromptVisible:e.isDeleteAllPromptVisible,threadCount:e.getThreads().length,onNewComment:e.onNewComment,onDeleteAllRenderPrompt:e.onDeleteAllRenderPrompt,newCommentButtonRef:e.newCommentButtonRef,moreItemsButtonRef:e.moreItemsButtonRef,isDisabled:e.isHeaderDisabled,areCommentsEnabled:e.areCommentsEnabled}),e.shouldShowMessageBar&&r.a.createElement(S,{localization:e.localization,commentError:e.commentError,onDismissMessageError:e.onDismissMessageError,telemetryApi:e.telemetryApi}),e.isDeleteAllPromptVisible&&r.a.createElement(A,{onCancelPrompt:e.onCancelPrompt,onDeleteAll:e.onDeleteAll,theme:e.theme,localization:e.localization,telemetryApi:e.telemetryApi}),e.isProcessing&&r.a.createElement(d.e,{theme:e.theme,loadingMessage:e.localization.getString("StateLoading.Loading.Message")}),e.shouldShowCommentsList&&r.a.createElement(C,{hostableComponentClass:e.hostableComponentClass,telemetryApi:e.telemetryApi,localization:e.localization,theme:e.theme,isDeleteAllPromptVisible:e.isDeleteAllPromptVisible,getThreads:e.getThreads,draftInfo:e.draftInfo,toFocusCommentId:e.toFocusCommentId,onClearFocusCommentId:e.onClearFocusCommentId,commentCardWidth:e.commentCardWidth,areCommentsEnabled:e.areCommentsEnabled,mediaType:e.mediaType,isPanelOpen:e.isPanelOpen,longLivedQosEvents:e.longLivedQosEvents,listContainerDivRef:e.listContainerDivRef,commentCardListRef:e.commentCardListRef}),e.shouldShowMessagePane&&r.a.createElement(H,{theme:e.theme,localization:e.localization,areCommentsEnabled:e.areCommentsEnabled,mediaType:e.mediaType,commentError:e.commentError,telemetryApi:e.telemetryApi,longLivedQosEvents:e.longLivedQosEvents}))},N=function(){function e(e,t,n,a,i,r,o,s,c){var d=this;this.InsertCommentHandler=e,this.UpdateCommentHandler=t,this.DeleteCommentHandler=n,this.SelectCommentHandler=a,this.HighlightCommentHandler=i,this.LoadCommentHandler=r,this.ContextChangeCommentHandler=o,this.ModelCapabilitiesHandler=s,this.CommentErrorHandler=c,this.callback=function(e,t){e===p.n.CommentsChanged&&Object(p.p)(t)?d.commentsChangeEventHandler(t):d.LoadCommentHandler&&e===p.n.LoadComments?d.LoadCommentHandler(t):d.ContextChangeCommentHandler&&e===p.n.CommentContextChanged?d.ContextChangeCommentHandler(t):d.ModelCapabilitiesHandler&&e===p.n.ModelCapabilitiesChanged&&d.ModelCapabilitiesHandler(t)},this.errorCallback=function(e){d.CommentErrorHandler&&d.CommentErrorHandler(e)}}return e.prototype.commentsChangeEventHandler=function(e){var t=this;e.changes.forEach(function(e){e.type===p.t.Insert?t.InsertCommentHandler(e):e.type===p.t.Modify?t.UpdateCommentHandler(e):e.type===p.t.Delete&&t.DeleteCommentHandler(e)}),e.contextDetails&&e.contextDetails.highlightedCommentId&&this.HighlightCommentHandler(e.contextDetails.highlightedCommentId),e.contextDetails&&e.contextDetails.selectedCommentId&&this.SelectCommentHandler(e.contextDetails.selectedCommentId)},e}(),B=function(e){function t(t){var n,a,r=this;return(r=e.call(this,t)||this).pluginPaneDivRef=i.createRef(),r.newCommentButtonRef=i.createRef(),r.moreItemsButtonRef=i.createRef(),r.listContainerDivRef=i.createRef(),r.commentCardListRef=i.createRef(),r.commentCardListMarginOffset=16,r.commentCardDefaultSize=261,r.newComment=function(){r.props.hostCommentAPI.triggerUIAction(p.i.AddComment)},r.selectComment=function(e){var t;r.props.telemetryApi.userAction({name:"SelectComment",playbackTimeSec:null!==(t=r.props.currentPlaybackTimeInSeconds.value)&&void 0!==t?t:-1,actionType:"Unknown"});var n=r.getThreads().findIndex(function(t){return t.commentId===e});r.isThreadInCurrentListPage(n)||r.setState({currentListPage:Math.floor(n/10)}),setTimeout(function(){var e;n>-1&&(null===(e=r.commentCardListRef.current)||void 0===e||e.scrollToIndex(n,function(e){return r.getCardScrollHeight(e)},f.e.auto))},0)},r.highlightComment=function(){},r.updateComment=function(){r.setState({commentError:void 0})},r.insertComment=function(e){r.setState({threadCount:r.getThreads().length,draftInfo:{},isProcessing:!1,toFocusCommentId:e.model.commentId,commentError:void 0})},r.onClearFocusCommentId=function(){r.setState({toFocusCommentId:""})},r.loadComment=function(e){var t=e.comments.filter(function(e){return""===e.parentId});r.setState({threadCount:r.state.threadCount+t.length}),"Loaded"===r.props.hostCommentAPI.getCommentsLoadStatus()&&(r.setState({isProcessing:!1}),r.props.targetCommentId&&""!==r.props.targetCommentId&&r.props.hostCommentAPI.selectComment(r.props.targetCommentId))},r.commentsContextChange=function(e){r.setState({threadCount:0})},r.onDeleteRenderPrompt=function(){var e;r.props.telemetryApi.userAction({name:"ClickDeleteAllComments",playbackTimeSec:null!==(e=r.props.currentPlaybackTimeInSeconds.value)&&void 0!==e?e:-1,actionType:"Unknown"}),r.setState({isDeleteAllPromptVisible:!0,commentError:void 0})},r.deleteComment=function(e){r.setState({threadCount:r.getThreads().length,commentError:void 0})},r.cancelDeleteAllPrompt=function(){var e;r.props.telemetryApi.userAction({name:"ClickCancelDeleteAllComments",playbackTimeSec:null!==(e=r.props.currentPlaybackTimeInSeconds.value)&&void 0!==e?e:-1,actionType:"Unknown"}),r.setState({isDeleteAllPromptVisible:!1})},r.deleteAllComments=function(){var e;r.props.telemetryApi.userAction({name:"ClickConfirmDeleteAllComments",playbackTimeSec:null!==(e=r.props.currentPlaybackTimeInSeconds.value)&&void 0!==e?e:-1,actionType:"Unknown"}),r.props.hostCommentAPI.deleteAllComments(),r.setState({threadCount:0,isDeleteAllPromptVisible:!1})},r.commentErrorHandler=function(e){11===e.eventType&&r.props.onChangeCommentsEnabled(!1),9!==e.eventType&&10!==e.eventType&&8!==e.eventType||r.setState({threadCount:r.getThreads().length,draftInfo:{}}),r.setState({commentError:e,isProcessing:!1})},r.onDismissMessageError=function(){var e;r.props.telemetryApi.userAction({name:"ClickDismissErrorMessageBar",playbackTimeSec:null!==(e=r.props.currentPlaybackTimeInSeconds.value)&&void 0!==e?e:-1,actionType:"Unknown"}),r.setState({commentError:void 0})},r.adaptCardsToContainerWidth=function(){var e=r.pluginPaneDivRef.current,t=null==e?void 0:e.offsetWidth;t&&(Object(p.g)(t-r.commentCardListMarginOffset),r.setState({commentCardWidth:t-r.commentCardListMarginOffset}))},r.getThreads=function(){return r.props.hostCommentAPI.getThreads()},r.isThreadInCurrentListPage=function(e){return Math.floor(e/10)===r.state.currentListPage},r.state={threadCount:0,draftInfo:{},isDeleteAllPromptVisible:!1,isProcessing:!0,toFocusCommentId:"",commentCardWidth:r.commentCardDefaultSize,commentError:void 0,areCommentsEnabled:r.props.areCommentsEnabled.value,isPanelOpen:null===(a=null===(n=r.props.isPanelOpen)||void 0===n?void 0:n.value)||void 0===a||a,currentListPage:-1},r.commentEventHandler=new N(r.insertComment,r.updateComment,r.deleteComment,r.selectComment,r.highlightComment,r.loadComment,r.commentsContextChange,void 0,r.commentErrorHandler),r.lockProcessEventHandler=function(e){r.setState({isProcessing:e})},r.draftEventHandler=function(e,t){r.setState({draftInfo:{draftId:e,parentId:t}}),""!==t&&r.selectComment(t)},r.props.areCommentsEnabled.subscribe(function(e){r.state.areCommentsEnabled!==e&&r.setState({areCommentsEnabled:e,commentError:void 0,draftInfo:{}})}),r.props.isPanelOpen&&r.props.isPanelOpen.subscribe(function(e){r.state.isPanelOpen!==e&&r.setState({isPanelOpen:e})}),r}return Object(s.a)(t,e),t.prototype.componentDidMount=function(){switch(this.props.hostCommentAPI.registerForCommentEvents(this.commentEventHandler.callback),this.props.hostCommentAPI.registerForCommentErrorEvents(this.commentEventHandler.errorCallback),this.props.hostCommentAPI.registerForDraftEvents(this.draftEventHandler),this.props.hostCommentAPI.registerForLockProcessEvents(this.lockProcessEventHandler),this.props.hostCommentAPI.getCommentsLoadStatus()){case"Loaded":var e=this.getThreads();this.setState({commentError:void 0,isProcessing:!1,threadCount:e.length}),this.props.targetCommentId&&""!==this.props.targetCommentId&&this.props.hostCommentAPI.selectComment(this.props.targetCommentId);break;case"NotLoaded":this.setState({isProcessing:!0});break;case"LoadFailed":this.setState({commentError:{eventType:13,isFatal:!0},isProcessing:!1,threadCount:0})}this.adaptCardsToContainerWidth(),window.addEventListener("resize",this.adaptCardsToContainerWidth)},t.prototype.componentWillUnmount=function(){this.state.draftInfo.draftId&&this.props.hostCommentAPI.dispatchInterruptableCommand({type:"DiscardDraft",mode:m.e.ForceDiscard}),this.props.hostCommentAPI.unregisterForCommentEvents(this.commentEventHandler.callback),this.props.hostCommentAPI.unregisterForCommentErrorEvents(this.commentEventHandler.errorCallback),this.props.hostCommentAPI.unregisterForDraftEvents(this.draftEventHandler),this.props.hostCommentAPI.unregisterForLockProcessEvents(this.lockProcessEventHandler),window.removeEventListener("resize",this.adaptCardsToContainerWidth)},t.prototype.componentDidUpdate=function(e,t){var n,a,i,r=this;t.threadCount>this.state.threadCount?null===(n=this.newCommentButtonRef.current)||void 0===n||n.focus():!t.isDeleteAllPromptVisible||this.state.isDeleteAllPromptVisible||this.state.isProcessing?""!==t.draftInfo.draftId&&""===this.state.draftInfo.draftId&&(null===(i=this.newCommentButtonRef.current)||void 0===i||i.focus()):null===(a=this.moreItemsButtonRef.current)||void 0===a||a.focus(),this.state.isPanelOpen&&!t.isPanelOpen&&setTimeout(function(){r.adaptCardsToContainerWidth()},0)},t.prototype.render=function(){var e,t,n=!((0!==this.state.threadCount||this.state.draftInfo.draftId)&&!(null===(e=this.state.commentError)||void 0===e?void 0:e.isFatal)||this.state.isProcessing),a=!n&&!this.state.isProcessing,r=!(!this.state.isProcessing&&!(null===(t=this.state.commentError)||void 0===t?void 0:t.isFatal)&&this.state.areCommentsEnabled&&!this.props.isReadOnly),o=!(!this.state.commentError||this.state.commentError.isFatal);return i.createElement(R,{hostCommentAPI:this.props.hostCommentAPI,hostableComponentClass:this.props.hostableComponentClass,telemetryApi:this.props.telemetryApi,localization:this.props.localization,theme:this.props.theme,userCanWrite:this.props.userCanWrite,isHostTrusted:this.props.isHostTrusted,isDeleteAllPromptVisible:this.state.isDeleteAllPromptVisible,getThreads:this.getThreads,draftInfo:this.state.draftInfo,pluginPaneDivRef:this.pluginPaneDivRef,newCommentButtonRef:this.newCommentButtonRef,moreItemsButtonRef:this.moreItemsButtonRef,listContainerDivRef:this.listContainerDivRef,commentCardListRef:this.commentCardListRef,commentCardWidth:this.state.commentCardWidth,onNewComment:this.newComment,onDeleteAll:this.deleteAllComments,onCancelPrompt:this.cancelDeleteAllPrompt,onDeleteAllRenderPrompt:this.onDeleteRenderPrompt,isProcessing:this.state.isProcessing,toFocusCommentId:this.state.toFocusCommentId,onClearFocusCommentId:this.onClearFocusCommentId,commentError:this.state.commentError,onDismissMessageError:this.onDismissMessageError,areCommentsEnabled:this.state.areCommentsEnabled,mediaType:this.props.mediaType,isPanelOpen:this.state.isPanelOpen,longLivedQosEvents:this.props.longLivedQosEvents,shouldShowMessagePane:n,shouldShowCommentsList:a,shouldShowMessageBar:o,isHeaderDisabled:r})},t.prototype.getCardScrollHeight=function(e){var t,n,a=null===(n=null===(t=this.listContainerDivRef.current)||void 0===t?void 0:t.firstChild)||void 0===n?void 0:n.firstChild;if(!a)return 0;var i=a.querySelector("[data-list-index='".concat(e,"']"));return i?i.clientHeight:0},t}(i.Component),j=function(e){function t(t){var n=e.call(this,t)||this;return n.defaultCommentCardHeight=208,n.state={commentCardListControllerProps:void 0,errorState:!1},n}return Object(s.a)(t,e),t.prototype.componentDidMount=function(){this.initializeCommentCardListControllerProps(this.props.commentPropsPromise)},t.prototype.componentWillUnmount=function(){this.contentExtensionSubscription&&this.contentExtensionSubscription.unsubscribe()},t.prototype.render=function(){return this.state.errorState?i.createElement(u.e,{className:b.errorState},this.props.localization.getString("Comments.FatalError")):this.state.commentCardListControllerProps&&this.state.commentCardListControllerProps.hostableComponentClass?i.createElement(B,Object(s.e)({},this.state.commentCardListControllerProps)):i.createElement(d.e,{theme:this.props.theme,loadingMessage:this.props.localization.getString("StateLoading.Loading.Message")})},t.prototype.initializeCommentCardListControllerProps=function(e){return Object(s.t)(this,void 0,void 0,function(){var t,n,a,i,r,o;return Object(s.i)(this,function(s){switch(s.label){case 0:t={name:"CommentPaneControllerPropsAcquired"},n=this.props.telemetryApi.startQos(t),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,e];case 2:return a=s.sent(),i={hostCommentAPI:a.hostCommentAPI,commentCardHeight:this.defaultCommentCardHeight,theme:this.props.theme,telemetryApi:a.telemetryUtils.telemetryApi,localization:this.props.localization,userCanWrite:a.userCanWrite,isHostTrusted:a.isHostTrusted,hostableComponentClass:void 0,areCommentsEnabled:this.props.areCommentsEnabled,onChangeCommentsEnabled:this.props.onChangeCommentsEnabled,mediaType:this.props.mediaType,isPanelOpen:this.props.isPanelOpen,currentPlaybackTimeInSeconds:this.props.currentPlaybackTimeInSeconds,longLivedQosEvents:this.props.longLivedQosEvents,targetCommentId:this.props.targetCommentId,isReadOnly:a.isReadOnly},a.webThemeAPIProvider.theme=this.props.theme,this.getHostableComponent(a.sharedCommentsProvider),n.end(),this.setState({commentCardListControllerProps:i}),[3,4];case 3:throw r=s.sent(),(o=Object(c.e)(r)).name="RichCommentsError",o.message=Object(l.n)(o.message),t.richCommentsErrorType="CommentPaneControllerPropsPromiseError",n.endUnexpectedError("Fatal",o),this.props.longLivedQosEvents.timeToInteractive&&(this.props.longLivedQosEvents.timeToInteractive.endUnexpectedError("Fatal",o),this.props.longLivedQosEvents.timeToInteractive=void 0),this.setState({errorState:!0}),o;case 4:return[2]}})})},t.prototype.getHostableComponent=function(e){return Object(s.t)(this,void 0,void 0,function(){var t,n,a=this;return Object(s.i)(this,function(i){switch(i.label){case 0:return this.extensionCollection=e.initializeExtensionProviderCollection(),(n=this.extensionCollection)?[4,e.onExtensionProviderCollectionUpdate(this.extensionCollection)]:[3,2];case 1:n=i.sent(),i.label=2;case 2:return t=n,this.state.commentCardListControllerProps&&this.setState({commentCardListControllerProps:Object(s.e)(Object(s.e)({},this.state.commentCardListControllerProps),{hostableComponentClass:t,commentCardHeight:e.commentCardHeight?e.commentCardHeight:this.defaultCommentCardHeight})}),this.contentExtensionSubscription=this.extensionCollection&&this.extensionCollection.onUpdated.subscribe(function(){return Object(s.t)(a,void 0,void 0,function(){var t,n;return Object(s.i)(this,function(a){switch(a.label){case 0:return(n=this.extensionCollection)?[4,e.onExtensionProviderCollectionUpdate(this.extensionCollection)]:[3,2];case 1:n=a.sent(),a.label=2;case 2:return t=n,this.state.commentCardListControllerProps&&this.setState({commentCardListControllerProps:Object(s.e)(Object(s.e)({},this.state.commentCardListControllerProps),{hostableComponentClass:t,commentCardHeight:e.commentCardHeight?e.commentCardHeight:this.defaultCommentCardHeight})}),[2]}})})}),[2]}})})},t}(i.Component),V=function(e){var t=Object(o.e)(),n=e.telemetryApi.startQos({name:"TimeToInteractive"});return r.a.createElement(j,{telemetryApi:e.telemetryApi,localization:e.localization,theme:t,commentPropsPromise:e.commentPropsPromise,longLivedQosEvents:{timeToInteractive:n},areCommentsEnabled:e.areCommentsEnabled,onChangeCommentsEnabled:e.onChangeCommentsEnabled,mediaType:e.mediaType,isPanelOpen:e.isPanelOpen,currentPlaybackTimeInSeconds:e.currentPlaybackTimeInSeconds,targetCommentId:e.targetCommentId})},z=n(1671),G=n(286),K=n(1931),W=-2130915315,q=function(){function e(e,t,n,a,i){this.commentService=e,this.eventQueueAPI=t,this.errorEventQueueAPI=n,this.telemetryApi=a,this._settings=i,this.commentsLoadStatus="NotLoaded"}return Object.defineProperty(e.prototype,"currentDraftSession",{get:function(){return this._currentDraftSession},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newDraftId",{get:function(){return this.commentService.generateNewDraftId()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"threadComments",{get:function(){return this.commentService.getThreadModelList()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastIndex",{get:function(){return this.commentService.getCommentModelList().getComments.length},enumerable:!1,configurable:!0}),e.prototype.initializeContext=function(){this.contextChanged()},e.prototype.unloadComments=function(){this.commentService.unloadComments().then(function(e){})},e.prototype.contextChanged=function(){var e=this;this.commentsLoadStatus="NotLoaded";var t={name:"TimeToInteractionResponse",richCommentsThreadNumber:"0",resultVariant:"HostCommentAPILoadComments"};this.eventQueueAPI.pushEvent({eventType:p.n.CommentContextChanged,payload:{numberOfThreads:0,numberOfComments:0,newNextPopulatedContextDetails:p.s.OnlyCommentsInCurrent,contextDetails:this.getContextDetails(),contextDrafts:void 0,selectedThreadIndex:void 0}});var n=this.telemetryApi.startQos(t);this.commentService.loadComments().then(function(a){var i=e.commentService.getCommentModelList();e._topVisibleThread=i.getComments[0]&&i.getComments[0].commentId,e._highlightedThread=i.getComments[0]&&i.getComments[0].commentId,e._selectedThread=void 0,e.loadCommentByChunks(i),t.richCommentsThreadNumber=i.getThreads.length.toString(),n.end(),e.commentsLoadStatus="Loaded"}).catch(function(a){var i=Object(c.e)(a);throw i.name="RichCommentsError",t.richCommentsErrorType="HostCommentAPILoadCommentsError",K.e.isServiceError(i)&&i.isExpected?n.endExpectedError("Fatal",i):n.endUnexpectedError("Fatal",i),e.commentsLoadStatus="LoadFailed",e.errorEventQueueAPI.pushEvent({eventType:13,isFatal:!0}),i})},e.prototype.contextReload=function(){var e={eventType:p.n.CommentContextReload,payload:{comments:this.commentService.getCommentModelList().getComments,numberOfThreads:this.commentService.getCommentModelList().getThreads.length}};this.eventQueueAPI.pushEvent(e)},e.prototype.highlightComment=function(e){if(this.commentService.getCommentModelList().findComment(e)){this._highlightedThread=e;var t={eventType:p.n.CommentsChanged,payload:{changes:[],contextDetails:{highlightedCommentId:this._highlightedThread}}};this.eventQueueAPI.pushEvent(t)}else console.warn("HighlightComment: CommentId was empty or comment does not exist anymore")},e.prototype.selectComment=function(e,t){var n;if(e!==(null===(n=this._currentDraftSession)||void 0===n?void 0:n.draftId)){var a=this.commentService.getCommentModelList().findComment(e);if(!a)return this.telemetryApi.warn(Object(l.n)("SelectComment: Comment does not exist anymore"),{name:"SelectedCommentNotAvailable",isExpected:!0}),void this.errorEventQueueAPI.pushEvent({eventType:15});if(this._selectedThread=""!==a.parentId?a.parentId:e,t){var i={eventType:p.n.CommentsChanged,payload:{changes:[],contextDetails:{selectedCommentId:this._selectedThread}}};this.eventQueueAPI.pushEvent(i)}}},e.prototype.insertComment=function(e){return Object(s.t)(this,void 0,void 0,function(){var t,n;return Object(s.i)(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.commentService.insertComment(e)];case 1:return t=a.sent(),this._selectedThread=e.parentId||t[0].model.commentId,this._settings.forceSync?this.contextChanged():this.commentsChanged(t),[3,3];case 2:if(n=a.sent(),!K.e.isServiceError(n))throw n;throw 404===n.statusCode?(this._selectedThread=void 0,this._highlightedThread=void 0,this.contextReload(),""!==e.parentId?this.errorEventQueueAPI.pushEvent({eventType:9}):this.errorEventQueueAPI.pushEvent({eventType:3})):403===n.statusCode?(this._selectedThread=void 0,this._highlightedThread=void 0,this.setCommentsToReadOnly(),this.errorEventQueueAPI.pushEvent({eventType:11})):(this.contextReload(),""!==e.parentId?this.errorEventQueueAPI.pushEvent({eventType:2}):this.errorEventQueueAPI.pushEvent({eventType:3})),n;case 3:return[2]}})})},e.prototype.updateComment=function(e,t){return Object(s.t)(this,void 0,void 0,function(){var n,a;return Object(s.i)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.commentService.updateComment(e,t)];case 1:return n=i.sent(),this._settings.forceSync?this.contextChanged():this.commentsChanged(n),[3,3];case 2:if(a=i.sent(),!K.e.isServiceError(a))throw a;throw 404===a.statusCode?(this._selectedThread=void 0,this._highlightedThread=void 0,this.contextReload(),this.errorEventQueueAPI.pushEvent({eventType:10})):403===a.statusCode?(this._selectedThread=void 0,this._highlightedThread=void 0,this.setCommentsToReadOnly(),this.errorEventQueueAPI.pushEvent({eventType:11})):(this.contextReload(),this.errorEventQueueAPI.pushEvent({eventType:4})),a;case 3:return[2]}})})},e.prototype.deleteComment=function(e){return Object(s.t)(this,void 0,void 0,function(){var t,n;return Object(s.i)(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.commentService.deleteComment(e)];case 1:return t=a.sent(),this._settings.forceSync?this.contextChanged():this.commentsChanged(t),[3,3];case 2:if(n=a.sent(),!K.e.isServiceError(n))throw n;throw 404===n.statusCode?(this._selectedThread=void 0,this._highlightedThread=void 0,this.contextReload(),this.errorEventQueueAPI.pushEvent({eventType:8})):(this.contextReload(),this.errorEventQueueAPI.pushEvent({eventType:5})),n;case 3:return[2]}})})},e.prototype.deleteAllComments=function(){return Object(s.t)(this,void 0,void 0,function(){var e,t;return Object(s.i)(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.commentService.deleteAllComments()];case 1:return e=n.sent(),this._settings.forceSync?this.contextChanged():this.commentsChanged(e),[3,3];case 2:throw t=n.sent(),this._selectedThread=void 0,this._highlightedThread=void 0,this.contextChanged(),this.errorEventQueueAPI.pushEvent({eventType:6}),t;case 3:return[2]}})})},e.prototype.setDraftSession=function(e){if(this._currentDraftSession&&e!==this._currentDraftSession)throw new Error("SetDraftSession: Trying to overwrite existing session");this._currentDraftSession||(this._currentDraftSession=e)},e.prototype.removeDraftSession=function(){this._currentDraftSession=void 0},e.prototype.getThreadReplyCount=function(e){return this.commentService.getThreadReplyCount(e)},e.prototype.enableComments=function(){return Object(s.t)(this,void 0,void 0,function(){return Object(s.i)(this,function(e){switch(e.label){case 0:return this.commentsLoadStatus="NotLoaded",[4,this.commentService.enableComments()];case 1:return e.sent(),[2]}})})},e.prototype.disableComments=function(){return Object(s.t)(this,void 0,void 0,function(){return Object(s.i)(this,function(e){switch(e.label){case 0:return[4,this.commentService.disableComments()];case 1:return e.sent(),this.setCommentsToReadOnly(),[2]}})})},e.prototype.getCommentsLoadStatus=function(){return this.commentsLoadStatus},e.prototype.likeComment=function(e,t){return Object(s.t)(this,void 0,void 0,function(){var n,a,i,r,o,c;return Object(s.i)(this,function(s){switch(s.label){case 0:if(n=this.commentService.getCommentModelList().getComments,-1===(a=n.findIndex(function(t){return t.commentId===e}))||a>=n.length)throw this.contextReload(),this.errorEventQueueAPI.pushEvent({eventType:16}),(i=new K.e("CommentControllerLikeCommentError",Object(l.n)("Like failed: Comment not found"))).isExpected=!0,i;r=n[a],s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.commentService.likeComment(a,r,t)];case 2:return o=s.sent(),this.commentsChanged([o]),[3,4];case 3:if(c=s.sent(),!K.e.isServiceError(c))throw c;throw 404===c.statusCode?(this.contextReload(),this.errorEventQueueAPI.pushEvent({eventType:16}),c.isExpected=!0):this.errorEventQueueAPI.pushEvent({eventType:17}),c;case 4:return[2]}})})},e.prototype.getContextDetails=function(){return{nextPopulatedContextDetails:p.s.OnlyCommentsInCurrent,commentThreadCounts:null,topVisibleThreadId:this._topVisibleThread||null,selectedCommentId:this._selectedThread||null,highlightedCommentId:this._highlightedThread||null,isReadOnly:this._settings.readOnly}},e.prototype.loadCommentByChunks=function(e){for(var t=0;t<=e.getComments.length;t+=this._settings.loadChunkSize)this.eventQueueAPI.pushEvent({eventType:p.n.LoadComments,payload:{comments:e.getComments.slice(t,t+this._settings.loadChunkSize)}})},e.prototype.commentsChanged=function(e){var t={eventType:p.n.CommentsChanged,payload:{changes:e,contextDetails:this.getContextDetails()}};this.eventQueueAPI.pushEvent(t)},e.prototype.setCommentsToReadOnly=function(){var e={nextPopulatedContextDetails:p.s.OnlyCommentsInCurrent,commentThreadCounts:null,topVisibleThreadId:this._topVisibleThread||null,selectedCommentId:this._selectedThread||null,highlightedCommentId:this._highlightedThread||null,isReadOnly:!0},t={eventType:p.n.CommentsChanged,payload:{changes:[],contextDetails:e}};this.eventQueueAPI.pushEvent(t)},e}(),Q=function(){function e(e){void 0===e&&(e=[]),this.commentEventListeners=e}return e.prototype.registerForCommentEvents=function(e){return this.commentEventListeners.push(e),this.commentEventListeners.length},e.prototype.unregisterForCommentEvents=function(e){var t=this.commentEventListeners.indexOf(e);return t>-1&&this.commentEventListeners.splice(t,1),this.commentEventListeners.length},e.prototype.pushEvent=function(e){var t=this;setTimeout(function(){for(var n=0,a=t.commentEventListeners;n<a.length;n++)(0,a[n])(e)},0)},e}(),Y=function(){function e(e){void 0===e&&(e=[]),this.commentEventListeners=e}return e.prototype.registerForCommentEvents=function(e){return this.commentEventListeners.push(e),this.commentEventListeners.length},e.prototype.unregisterForCommentEvents=function(e){var t=this.commentEventListeners.indexOf(e);return t>-1&&this.commentEventListeners.splice(t,1),this.commentEventListeners.length},e.prototype.pushEvent=function(e){var t=this;setTimeout(function(){for(var n=0,a=t.commentEventListeners;n<a.length;n++)(0,a[n])(e.eventType,e.payload)},0)},e}(),J=function(){function e(e,t,n,a,i,r){this.commentControllerSettings=t,this.clientHostCommentAPISettings=n,this.telemetryApi=a,this.currentPlaybackTimeInSeconds=i,this.officeDeltaTranslator=r,this.interruptableCommandsQueueAPI=[],this.draftEventListeners=[],this.lockProcessEventListeners=[],this.isCommitInProgress=!1,this.navigationQueueAPI=new Map,this.eventQueueAPI=new Y,this.errorEventQueueAPI=new Q,this.commentController=new q(e,this.eventQueueAPI,this.errorEventQueueAPI,a,this.commentControllerSettings),this.checkAtMentionCapability=this.checkAtMentionCapability.bind(this),this.commit=this.commit.bind(this),this.endCommentSession=this.endCommentSession.bind(this),this.createComment=this.createComment.bind(this),this.deleteComment=this.deleteComment.bind(this),this.selectComment=this.selectComment.bind(this),this.updateCommentData=this.updateCommentData.bind(this),this.highlightComment=this.highlightComment.bind(this),this.registerForCommentEvents=this.registerForCommentEvents.bind(this),this.unregisterForCommentEvents=this.unregisterForCommentEvents.bind(this),this.registerForAction=this.registerForAction.bind(this),this.unregisterForAction=this.unregisterForAction.bind(this),this.loadThreads=this.loadThreads.bind(this),this.resolveSupported=this.resolveSupported.bind(this),this.selectFirstThreadInNextCommentContext=this.selectFirstThreadInNextCommentContext.bind(this),this.selectLastThreadInPreviousCommentContext=this.selectLastThreadInPreviousCommentContext.bind(this),this.setThreadResolvedState=this.setThreadResolvedState.bind(this),this.beginDraftingAsync=this.beginDraftingAsync.bind(this),this.presentLinkToComment=this.presentLinkToComment.bind(this),this.initializeContext=this.initializeContext.bind(this)}return e.prototype.beginDraftingAsync=function(e){var t,n=this,a="CREATE"===e.sessionType?this.commentController.newDraftId:e.draftId;if("METADATA"!==e.sessionType){var i=void 0;switch(e.sessionType){case"CREATE":i="ClickNewComment";break;case"REPLY":i="ClickNewReply";break;case"EDIT":i="ClickEditComment";break;default:i="UnknownCommentAction"}this.telemetryApi.userAction({name:i,playbackTimeSec:null!==(t=this.currentPlaybackTimeInSeconds.value)&&void 0!==t?t:-1,actionType:"Unknown"})}return new Promise(function(t,i){n.commentController.currentDraftSession?i(new Error("Ongoing Session or Set Comment Failure")):(n.commentController.setDraftSession(Object(s.e)(Object(s.e)({},e),{draftId:a})),t({insertIndex:n.commentController.lastIndex,authorName:n.clientHostCommentAPISettings.userContext.DisplayName?n.clientHostCommentAPISettings.userContext.DisplayName:n.clientHostCommentAPISettings.userContext.UserId,authorIdentity:n.clientHostCommentAPISettings.userContext.UserId,authorEmail:n.clientHostCommentAPISettings.userContext.Email,author:n.clientHostCommentAPISettings.userContext}))}).then(function(t){if(!n.commentController.currentDraftSession)throw new Error("Draft already active.");var i=Object(s.e)(Object(s.e)({},t.updatedSessionParams||e),{draftId:a}),r=Object(p.b)(e)?e.threadId:"";return Object(p.h)(e)||n.draftEventListeners.forEach(function(e){e(a,r)}),Object(s.e)(Object(s.e)({},t),{updatedDraftSessionConfiguration:i})})},e.prototype.loadThreads=function(e){throw new Error("loadThreads: Method not implemented.")},e.prototype.createComment=function(e,t){var n=this;if(!this.commentController.currentDraftSession)throw new Error("Invalid Configuration");var a={name:"TimeToInteractionResponse",resultVariant:"HostCommentAPICreateComment"},i=this.telemetryApi.startQos(a),r={commentId:this.commentController.currentDraftSession.draftId,commentFlags:t.commentFlags?t.commentFlags:p.a.None,commentBody:e,date:t.date,parentId:t.parentId?t.parentId:"",author:this.clientHostCommentAPISettings.userContext};return this.validateCommentLengthAndMentionsCount(r.commentBody,a,i,"HostCommentAPICreateCommentError"),this.commentController.insertComment(r).then(function(){n.isCommitInProgress=!1,i.end()}).catch(function(e){n.isCommitInProgress=!1;var t=Object(c.e)(e);throw t.name="RichCommentsError",a.richCommentsErrorType="HostCommentAPICreateCommentError",K.e.isServiceError(t)&&t.isExpected?i.endExpectedError("Warning",t):i.endUnexpectedError("Warning",t),t}),r.commentId},e.prototype.deleteComment=function(e){var t;this.telemetryApi.userAction({name:"ClickDeleteComment",playbackTimeSec:null!==(t=this.currentPlaybackTimeInSeconds.value)&&void 0!==t?t:-1,actionType:"Unknown"});var n={name:"TimeToInteractionResponse",resultVariant:"HostCommentAPIDeleteComment"},a=this.telemetryApi.startQos(n);this.commentController.deleteComment(e).then(function(){a.end()}).catch(function(e){var t=Object(c.e)(e);throw t.name="RichCommentsError",n.richCommentsErrorType="HostCommentAPIDeleteCommentError",K.e.isServiceError(t)&&t.isExpected?a.endExpectedError("Warning",t):a.endUnexpectedError("Warning",t),t})},e.prototype.deleteAllComments=function(){var e=this,t={name:"TimeToInteractionResponse",resultVariant:"HostCommentAPIDeleteAllComments"},n=this.telemetryApi.startQos(t);this.lockProcessEventListeners.forEach(function(e){e(!0)}),this.commentController.deleteAllComments().then(function(){n.end(),e.lockProcessEventListeners.forEach(function(e){e(!1)})}).catch(function(a){var i=Object(c.e)(a);throw i.name="RichCommentsError",t.richCommentsErrorType="HostCommentAPIDeleteAllCommentsError",K.e.isServiceError(i)&&i.isExpected?n.endExpectedError("Warning",i):n.endUnexpectedError("Warning",i),e.lockProcessEventListeners.forEach(function(e){e(!1)}),i})},e.prototype.selectComment=function(e){this.commentController.selectComment(e,!0)},e.prototype.highlightComment=function(e){this.commentController.highlightComment(e)},e.prototype.updateCommentData=function(e,t,n){var a=this,i={name:"TimeToInteractionResponse",resultVariant:"HostCommentAPIUpdateComment"},r=this.telemetryApi.startQos(i);this.validateCommentLengthAndMentionsCount(t,i,r,"HostCommentAPIUpdateCommentError"),this.commentController.updateComment(e,t).then(function(){r.end(),a.isCommitInProgress=!1}).catch(function(e){a.isCommitInProgress=!1;var t=Object(c.e)(e);throw t.name="RichCommentsError",i.richCommentsErrorType="HostCommentAPIUpdateCommentError",K.e.isServiceError(t)&&t.isExpected?r.endExpectedError("Warning",t):r.endUnexpectedError("Warning",t),t})},e.prototype.setThreadResolvedState=function(e,t){throw new Error("setThreadResolvedState: Method not implemented.")},e.prototype.selectFirstThreadInNextCommentContext=function(){throw new Error("selectFirstThreadInNextCommentContext: Method not implemented.")},e.prototype.selectLastThreadInPreviousCommentContext=function(){throw new Error("selectLastThreadInPreviousCommentContext: Method not implemented.")},e.prototype.registerForCommentEvents=function(e){1===this.eventQueueAPI.registerForCommentEvents(e)&&(this.invalidateModelCapabilityFlags(),this.commentController.initializeContext())},e.prototype.unregisterForCommentEvents=function(e){0===this.eventQueueAPI.unregisterForCommentEvents(e)&&this.commentController.unloadComments()},e.prototype.registerForCommentErrorEvents=function(e){this.errorEventQueueAPI.registerForCommentEvents(e)},e.prototype.unregisterForCommentErrorEvents=function(e){this.errorEventQueueAPI.unregisterForCommentEvents(e)},e.prototype.registerForAction=function(e,t){if(e in this.navigationQueueAPI)throw new Error("Should not register for an action multiple times");this.navigationQueueAPI.set(e,t)},e.prototype.unregisterForAction=function(e){this.navigationQueueAPI.has(e)&&this.navigationQueueAPI.delete(e)},e.prototype.registerForInterruptableCommands=function(e){if(-1!==this.interruptableCommandsQueueAPI.indexOf(e))throw new Error("Same callback has already been registered for InterruptableCommands");this.interruptableCommandsQueueAPI.push(e)},e.prototype.unregisterForInterruptableCommands=function(e){var t=this.interruptableCommandsQueueAPI.indexOf(e);t>-1&&this.interruptableCommandsQueueAPI.splice(t,1)},e.prototype.resolveSupported=function(){return this.clientHostCommentAPISettings.resolveSupported},e.prototype.checkAtMentionCapability=function(){return Promise.resolve(!0)},e.prototype.presentLinkToComment=function(e){throw new Error("presentLinkToComment: Method not implemented.")},e.prototype.commit=function(e,t,n){var a,i,r=this;if(!this.commentController.currentDraftSession||this.commentController.currentDraftSession.draftId!==e)throw{message:"Invalid active draft",SDXHostAPIErrorCode:W};if(void 0===t&&this.commentController.currentDraftSession.sessionType!==p.o)throw{message:"Invalid argument",SDXHostAPIErrorCode:-2130915327};var o=function(){var e;r.telemetryApi.userAction({name:"ClickPostComment",playbackTimeSec:null!==(e=r.currentPlaybackTimeInSeconds.value)&&void 0!==e?e:-1,actionType:"Unknown"})},s=this.commentController.currentDraftSession;switch(s.sessionType){case"CREATE":if(o(),!Object(p.m)(s))throw{message:"Invalid draft configuration",SDXHostAPIErrorCode:W};return this.isCommitInProgress=!0,this.createComment(t||"",{commentFlags:p.a.IsNew,date:new Date});case"EDIT":if(o(),!Object(p._)(s))throw{message:"Invalid draft configuration",SDXHostAPIErrorCode:W};return this.isCommitInProgress=!0,this.updateCommentData(s.commentId,t||"",n),s.commentId;case"REPLY":if(o(),!Object(p.b)(s))throw{message:"Invalid draft configuration",SDXHostAPIErrorCode:W};return this.isCommitInProgress=!0,this.createComment(t||"",{commentFlags:p.a.IsNew,date:new Date,parentId:s.threadId});case"METADATA":if(!Object(p.h)(s)||void 0!==t||void 0===n)throw{message:"Invalid draft configuration",SDXHostAPIErrorCode:W};return(null===(a=n.Reaction)||void 0===a?void 0:a.reactionType)===p.c.Like&&(this.isCommitInProgress||(this.isCommitInProgress=!0,this.telemetryApi.userAction({name:n.Reaction.isActive?"ClickLikeComment":"ClickUnlikeComment",playbackTimeSec:null!==(i=this.currentPlaybackTimeInSeconds.value)&&void 0!==i?i:-1,actionType:"Unknown"}),this.likeComment(s.threadId,n.Reaction.isActive))),"";default:throw{message:"Invalid Session Type",SDXHostAPIErrorCode:-2130915322}}},e.prototype.endCommentSession=function(e){var t;this.commentController.removeDraftSession(),this.isCommitInProgress||(this.telemetryApi.userAction({name:"ClickCancelComment",playbackTimeSec:null!==(t=this.currentPlaybackTimeInSeconds.value)&&void 0!==t?t:-1,actionType:"Unknown"}),this.draftEventListeners.forEach(function(e){e("","")}))},e.prototype.dispatchInterruptableCommand=function(e){this.interruptableCommandsQueueAPI.forEach(function(t){return t(e).then(function(t){console.warn("Interruptable command ".concat(e.type," succeed with result ").concat(p.r[t]))}).catch(function(t){console.warn("Interruptable command ".concat(e.type," threw an error: ").concat(t))})})},e.prototype.getThreads=function(){return this.commentController.threadComments},e.prototype.getThreadReplyCount=function(e){return this.commentController.getThreadReplyCount(e)},e.prototype.contextChange=function(e,t,n,a,i){this.commentControllerSettings=t,this.clientHostCommentAPISettings=n,this.telemetryApi=a,this.commentController=new q(e,this.eventQueueAPI,this.errorEventQueueAPI,this.telemetryApi,this.commentControllerSettings),this.officeDeltaTranslator=i,this.invalidateModelCapabilityFlags(),this.commentController.initializeContext()},e.prototype.initializeContext=function(){this.invalidateModelCapabilityFlags(),this.commentController.initializeContext()},e.prototype.registerForDraftEvents=function(e){this.draftEventListeners.push(e)},e.prototype.unregisterForDraftEvents=function(e){var t=this.draftEventListeners.indexOf(e);t>-1&&this.draftEventListeners.splice(t,1)},e.prototype.registerForLockProcessEvents=function(e){this.lockProcessEventListeners.push(e)},e.prototype.unregisterForLockProcessEvents=function(e){var t=this.lockProcessEventListeners.indexOf(e);t>-1&&this.lockProcessEventListeners.splice(t,1)},e.prototype.triggerUIAction=function(e){var t=this.navigationQueueAPI.get(e);t&&t({actionType:e,actionBehavior:p.e.Execute})},e.prototype.setCommentsEnabled=function(e){e?this.enableComments():this.disableComments()},e.prototype.likeComment=function(e,t){var n=this,a={name:"TimeToInteractionResponse",resultVariant:t?"HostCommentAPILikeComment":"HostCommentAPIUnlikeComment"},i=this.telemetryApi.startQos(a);this.commentController.likeComment(e,t).then(function(){n.isCommitInProgress=!1,i.end()}).catch(function(e){n.isCommitInProgress=!1;var t=Object(c.e)(e);throw t.name="RichCommentsError",a.richCommentsErrorType="HostCommentAPILikeCommentError",K.e.isServiceError(t)&&t.isExpected?i.endExpectedError("Warning",t):i.endUnexpectedError("Warning",t),t})},e.prototype.getCommentsLoadStatus=function(){return this.commentController.getCommentsLoadStatus()},e.prototype.invalidateModelCapabilityFlags=function(){var e={eventType:p.n.ModelCapabilitiesChanged,payload:{modelCapabilityFlags:this.clientHostCommentAPISettings.modelCapabilities,richTextCapabilityFlags:this.clientHostCommentAPISettings.richTextCapabilities}};this.eventQueueAPI.pushEvent(e)},e.prototype.enableComments=function(){return Object(s.t)(this,void 0,void 0,function(){var e,t,n,a;return Object(s.i)(this,function(i){switch(i.label){case 0:e={name:"TimeToInteractionResponse",resultVariant:"HostCommentAPIEnableComments"},t=this.telemetryApi.startQos(e),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.commentController.enableComments()];case 2:return i.sent(),t.end(),this.initializeContext(),[3,4];case 3:throw n=i.sent(),(a=Object(c.e)(n)).name="RichCommentsError",e.richCommentsErrorType="HostCommentAPIEnableCommentError",K.e.isServiceError(a)&&a.isExpected?t.endExpectedError("Warning",a):t.endUnexpectedError("Warning",a),this.lockProcessEventListeners.forEach(function(e){e(!1)}),a;case 4:return[2]}})})},e.prototype.disableComments=function(){return Object(s.t)(this,void 0,void 0,function(){var e,t,n,a;return Object(s.i)(this,function(i){switch(i.label){case 0:e={name:"TimeToInteractionResponse",resultVariant:"HostCommentAPIDisableComments"},t=this.telemetryApi.startQos(e),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.commentController.disableComments()];case 2:return i.sent(),t.end(),this.lockProcessEventListeners.forEach(function(e){e(!1)}),[3,4];case 3:throw n=i.sent(),(a=Object(c.e)(n)).name="RichCommentsError",e.richCommentsErrorType="HostCommentAPIDisableCommentError",K.e.isServiceError(a)&&a.isExpected?t.endExpectedError("Warning",a):t.endUnexpectedError("Warning",a),this.lockProcessEventListeners.forEach(function(e){e(!1)}),a;case 4:return[2]}})})},e.prototype.validateCommentLengthAndMentionsCount=function(e,t,n,a){try{this.officeDeltaTranslator.validateCommentLengthAndMentionsCount(e)}catch(e){var i=new Error;switch(e.commentErrorType){case 12:i.message="A comment cannot be empty.";break;case 1:i.message="A comment cannot have more than 2100 characters.";break;case 14:i.message="A comment cannot have more than 10 distinct @mentions.";break;default:e.commentErrorType=0,i.message="Uknown validation error in delta translator"}throw this.errorEventQueueAPI.pushEvent({eventType:e.commentErrorType}),t.richCommentsErrorType=a,n.endExpectedError("Warning",i),Object(s.e)(Object(s.e)({},i),{SDXHostAPIErrorCode:-2130915321})}},e}(),X=function(){function e(){this._listeners=[]}return e.prototype.add=function(e){this._listeners.push(e)},e.prototype.remove=function(e){var t=this._listeners.indexOf(e);t>=-1&&this._listeners.splice(t,1)},Object.defineProperty(e.prototype,"invoke",{get:function(){var e=this;return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e._listeners.forEach(function(e){return e.apply(void 0,t)})}},enumerable:!1,configurable:!0}),e}(),Z=function(){function e(){this.identifier="commentPaneViewContainer"}return Object.defineProperty(e.prototype,"containerType",{get:function(){return p.l.FullPane},enumerable:!1,configurable:!0}),e.prototype.openView=function(){this.hostingApp&&this.hostingApp.openView()},e.prototype.closeView=function(){this.hostingApp&&this.hostingApp.closeView()},e.prototype.moveFocusToCanvas_donotuse=function(){throw new Error("Method not implemented.")},e}(),$=function(){function e(){this.changedEvent=new X,this._viewContainer=new Z,this.fireEvent({eventType:p.d.ViewContainerChanged,newViewContainer:this._viewContainer})}return e.prototype.supplyHost=function(e){this._viewContainer.hostingApp=e},e.prototype.changeViewContainerType=function(e){throw new Error("Method not implemented.")},e.prototype.getViewContainer=function(){return this._viewContainer},e.prototype.registerForViewContainerEvents=function(e){this.changedEvent.add(e)},e.prototype.unregisterForViewContainerEvents=function(e){this.changedEvent.remove(e)},e.prototype.triggerVisibilityChangedEvent=function(e){this.fireEvent({eventType:p.d.VisibilityChanged,viewContainerVisibilityState:e})},e.prototype.fireEvent=function(e){this.changedEvent.invoke(e)},e}(),ee=function(){function e(){}return Object.defineProperty(e.prototype,"theme",{set:function(e){this._theme=e},enumerable:!1,configurable:!0}),e.prototype.getThemeMode=function(){return this._theme&&0===this._theme.palette.white.localeCompare("#ffffff",void 0,{sensitivity:"accent"})?0:1},e}(),te=n(1524),ne=n(742);!function(e){e.Enabled="true",e.Disabled="false"}(_||(_={}));var ae,ie,re={AccessibilityAnnotationTarget:_.Enabled,AccessibilityDescription:_.Enabled,CommentsFluentUI:_.Enabled,DiscreteHostedComments:_.Enabled,NewCommentButton:_.Enabled,NewDraftingUI:_.Enabled,PersonaColor:_.Enabled,PersonaIconImageForWeb:_.Enabled,CommentsFluentUIV2:_.Enabled,HyperlinksInComments:_.Enabled,HyperlinksWithDisplayText:_.Enabled,LivePersonaPicker:_.Enabled,LogDraftCommentIdPair:_.Enabled,NewBorderAndFocusLookInWeb:_.Enabled,NewModelState:_.Enabled,NewResolvedCardDesignInWeb:_.Enabled,NoDiscardOnFocusLoss:_.Enabled,TruncationUIWithReadMoreText:_.Enabled,NewSelectionInteractions:_.Enabled,WebThemeIntegration:_.Enabled,CommentReactions:_.Disabled,ContentNavigation:_.Disabled,ExtendedDrafting:_.Disabled,RenderDHCInPane:_.Disabled,TaskPaneWithNewInfrastructure:_.Disabled,LinkToComment:_.Disabled,CommentTasks:_.Disabled,CommentTasksFromReply:_.Disabled,RichContentEditIntegrationInWeb:_.Disabled,RichTextFormattingInWeb:_.Disabled,SmartReplies:_.Disabled,AtMentionFloodgateSurvey:_.Disabled,HeadlessBoot:_.Disabled,ReenableMentionContactCard:_.Disabled},oe=function(){function e(){var e=this;this.settingsStore=void 0,this._userCanWrite=!1,this._isHostTrusted=!1,this._isLokiServiceEnabled=!1,this._isGraphServiceEnabled=!1,this.initialize=function(t,n,a,i){void 0===i&&(i=!1),e.settingsStore=t,e.userCanWrite=n,e.isHostTrusted=a,e.isLokiServiceEnabled=i}}return Object.defineProperty(e,"instance",{get:function(){var t;return null!==(t=e._instance)&&void 0!==t?t:e._instance=new e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"featureGatesConfiguration",{get:function(){var e,t;return re.PersonaIconImageForWeb=null!==(e=this.getFeatureGatesConfigurationSetting("areProfilePicturesForCommentCardsEnabled"))&&void 0!==e?e:re.PersonaIconImageForWeb,re.CommentReactions=null!==(t=this.getFeatureGatesConfigurationSetting("isCommentsLikesEnabled"))&&void 0!==t?t:this.featureGatesConfiguration.CommentReactions,this._isLokiServiceEnabled||(re.LivePersonaPicker=_.Disabled,re.PersonaIconImageForWeb=_.Disabled),re},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userCanWrite",{get:function(){return this._userCanWrite},set:function(e){this._userCanWrite=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHostTrusted",{get:function(){return this._isHostTrusted},set:function(e){this._isHostTrusted=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLokiServiceEnabled",{get:function(){return this._isLokiServiceEnabled},set:function(e){this._isLokiServiceEnabled=e},enumerable:!1,configurable:!0}),e.prototype.getCommentControllerSettings=function(e){return{loadChunkSize:200,sendDraftIdsOnContextChange:!1,readOnly:null!=e&&e,forceSync:!1}},Object.defineProperty(e.prototype,"verifiedSettingsStore",{get:function(){if(!this.settingsStore)throw new Error("FeatureGateProvider not initialized!");return this.settingsStore},enumerable:!1,configurable:!0}),e.prototype.getClientHostCommentAPISettings=function(e){return{modelCapabilities:te.e.AtMentionKnown|te.e.TasksKnown|te.e.NewThread|te.e.AtMentionEnabled,richTextCapabilities:ne.DeltaFormattingType.TextAndMentions|ne.DeltaFormattingType.Hyperlink|ne.DeltaFormattingType.Color|ne.DeltaFormattingType.Highlight,userContext:e,resolveSupported:!1}},e.prototype.getIsAtMentionsPayloadEnabled=function(){var e=this.verifiedSettingsStore.getSettingObject("isCommentsAtMentionsPayloadEnabled","boolean");return!0===(null==e?void 0:e.value)},e.prototype.getIsAtMentionsNewFormatEnabled=function(){var e=this.verifiedSettingsStore.getSettingObject("isCommentsAtMentionsNewFormatEnabled","boolean");return!0===(null==e?void 0:e.value)&&this.getIsAtMentionsPayloadEnabled()},e.prototype.getIsTimeStampsEnabled=function(){var e=this.verifiedSettingsStore.getSettingObject("isCommentsTimeStampsEnabled","boolean");return!0===(null==e?void 0:e.value)},e.prototype.getIsCommentsLikesEnabled=function(){var e=this.verifiedSettingsStore.getSettingObject("isCommentsLikesEnabled","boolean");return!0===(null==e?void 0:e.value)},e.prototype.getFeatureGatesConfigurationSetting=function(e){var t=this.verifiedSettingsStore.getSettingObject(e,"boolean");if("boolean"==typeof(null==t?void 0:t.value))return(null==t?void 0:t.value)?_.Enabled:_.Disabled},e._instance=void 0,e}(),se=function(){function e(e){this.htmlElement=document.createElement("textarea"),this.currentUserEmail=e}return e.prototype.translateToSharePointFormat=function(e){var t=JSON.parse(e);return this.getCommentPayloadFromOdeltaObject(t)},e.prototype.translateToODeltaFormat=function(e){var t=this,n=e.text.split(/(<a[^>]+>.*?<\/a>|@mention&#123;\d&#125;)/g),a=[];return n.forEach(function(n){var i;try{if(""===n)return;var r=(new DOMParser).parseFromString(n,"text/xml").getElementsByTagName("a")[0];if(null==r?void 0:r.hasAttribute("data-sp-mention-user-id")){var o=r.textContent,c=r.getAttribute("data-sp-mention-user-id");if(o&&c){var d=null===(i=e.mentions)||void 0===i?void 0:i.find(function(e){var n;return e.email===t.currentUserEmail&&(null===(n=e.loginName)||void 0===n?void 0:n.endsWith("|".concat(c)))});return void a.push(Object(s.e)({insert:o,attributes:{atmention:{fullName:o.substring(1),email:c,resolveState:1}}},d&&{optional:{atmention:{isCurrentUser:!0}}}))}}if(r){var l=r.getAttribute("href"),u=r.textContent;if(l&&u)return void a.push({insert:t.decodeHtml(u),attributes:{link:l}});if(u)return void a.push({insert:t.decodeHtml(u)})}var f=(n=t.decodeHtml(n)).match(/@mention{(\d)}/);if(f){var p=parseInt(f[1],10);if(!e.mentions||p>=e.mentions.length)return;return void a.push(Object(s.e)({insert:"@"+e.mentions[p].name,attributes:{atmention:{fullName:e.mentions[p].name,email:e.mentions[p].email,resolveState:1}}},t.currentUserEmail===e.mentions[p].email&&{optional:{atmention:{isCurrentUser:!0}}}))}a.push({insert:n})}catch(e){a.push({insert:t.decodeHtml(n)})}}),JSON.stringify({ops:a})},e.prototype.validateCommentLengthAndMentionsCount=function(e){var t=this.getCommentPayloadFromOdeltaObject(JSON.parse(e));if(t.text.length>2100)throw{commentErrorType:1};if(null!==t.text.match(/^\s*$/g))throw{commentErrorType:12};if(Array.from(new Set(t.mentions.map(function(e){return e.email}))).length>10)throw{commentErrorType:14}},e.prototype.getCommentPayloadFromOdeltaObject=function(e){var t=this,n={mentions:[],text:""};if(!e.ops)return n;var a=oe.instance;return e.ops.forEach(function(e){e.attributes&&e.attributes.atmention?(a.getIsAtMentionsPayloadEnabled()&&n.mentions.push({email:e.attributes.atmention.email,name:e.insert.slice(1)}),n.text+=a.getIsAtMentionsNewFormatEnabled()?t.toSharePointAtMentionNewFormat(n.mentions.length-1):t.toSharePointAtMentionOldFormat(e.attributes.atmention.email,e.insert)):e.attributes&&e.attributes.link?n.text+=t.toSharePointLinkFormat(e.insert,e.attributes.link):n.text+=t.encodeHtml(e.insert)}),n},e.prototype.toSharePointAtMentionNewFormat=function(e){return"@mention{".concat(e,"}")},e.prototype.toSharePointAtMentionOldFormat=function(e,t){return'<a data-sp-mention-user-id="'.concat(e,'" href="mailto&#58;').concat(e,'" tabindex="-1">').concat(t,"</a>")},e.prototype.toSharePointLinkFormat=function(e,t){return'<a href="'.concat(t,'" tabindex="-1">').concat(this.encodeHtml(e),"</a>")},e.prototype.decodeHtml=function(e){if(this.htmlElement)return this.htmlElement.innerHTML=e,this.htmlElement.value;var t=document.createElement("textarea");return t.innerHTML=e,t.value},e.prototype.encodeHtml=function(e){if(this.htmlElement)return this.htmlElement.textContent=e,this.htmlElement.innerHTML;var t=document.createElement("textarea");return t.textContent=e,t.innerHTML},e}(),ce=function(){function e(e,t,n){this.sessionId=e,this.onePlayerVersion=t,this.telemetryApi=n}return e.prototype.getTelemetrySupport=function(){return{appName:"Stream",appVersion:this.onePlayerVersion,releaseAudience:"Internal",releaseChannel:"Insiders",sessionId:this.sessionId,disableUpload:!1,sendOtelEvent:this.getOtelEventLogger()}},e.prototype.getOtelEventLogger=function(){var e=this;return function(t){if(t.otelEvent&&t.otelEvent.dataFields&&t.otelEvent.eventContract){var n=!0,a="";t.otelEvent.eventContract.dataFields.forEach(function(e){"Activity.Success"===e.name&&(n=e.value),"zC.Activity.Result"===e.name&&(a=e.value)});var i={datafields:t.otelEvent.dataFields,eventContract:{dataFields:t.otelEvent.eventContract.dataFields}};if(n){var r={name:t.otelEvent.eventName,richCommentsTelemetryMessage:JSON.stringify(i)};e.telemetryApi.appLogic(r)}else{var o={errorOrMessage:a,name:t.otelEvent.eventName,isExpected:!1,richCommentsTelemetryMessage:JSON.stringify(i)};e.telemetryApi.warn(t.otelEvent.eventName,o)}}}},e}(),de=n(3620),le=n(1156),ue=n(3396),fe=ue.e.object({id:ue.e.string,parentId:ue.e.string,createdDate:ue.e.string,isLikedByUser:ue.e.boolean,likeCount:ue.e.number,likedBy:ue.e.optional(ue.e.array(ue.e.object({email:ue.e.string,name:ue.e.string}))),replyCount:ue.e.number,mentions:ue.e.union(ue.e.array(ue.e.object({email:ue.e.string,name:ue.e.string,loginName:ue.e.string})),ue.e.null),author:ue.e.object({email:ue.e.string,name:ue.e.string,isActive:ue.e.boolean}),text:ue.e.string}),pe=ue.e.object({id:ue.e.string,parentId:ue.e.string,createdDate:ue.e.string,isLikedByUser:ue.e.boolean,likeCount:ue.e.number,likedBy:ue.e.optional(ue.e.array(ue.e.object({email:ue.e.string,name:ue.e.string}))),replyCount:ue.e.number,replies:ue.e.optional(ue.e.array(fe)),mentions:ue.e.union(ue.e.array(ue.e.object({email:ue.e.string,name:ue.e.string,loginName:ue.e.string})),ue.e.null),author:ue.e.object({email:ue.e.string,name:ue.e.string,isActive:ue.e.boolean}),text:ue.e.string}),me=ue.e.object({email:ue.e.string,name:ue.e.string}),_e=ue.e.object({"odata.nextLink":ue.e.optional(ue.e.string),value:ue.e.array(pe)}),he=ue.e.object({"odata.nextLink":ue.e.optional(ue.e.string),value:ue.e.array(fe)}),be=ue.e.object({"odata.nextLink":ue.e.optional(ue.e.string),value:ue.e.array(me)}),ge=ue.e.object({value:ue.e.boolean}),ve=ue.e.any,ye="/_api/web/lists(':listId')/GetItemById(':itemId')/Comments(':commentId')",Se="/_api/web/lists(':listId')/GetItemById(':itemId')/Comments(':commentId')/replies",De=new Set([401,403,404,406,409,429,503]),Ie=ue.e.object({FormDigestValue:ue.e.string,FormDigestTimeoutSeconds:ue.e.number}),xe=function(){function e(e,t,n){this.sharePointLocator=e,this.getAccessToken=t,this.telemetryApi=n}return e.prototype.generateRequestDigest=function(){var e;return Object(s.t)(this,void 0,void 0,function(){var t,n,a,i,r,o,c,d,l,u,f;return Object(s.i)(this,function(s){switch(s.label){case 0:if(this.requestDigestCache&&this.requestDigestCache.expiration>Date.now())return[2,this.requestDigestCache];t={name:"SharePointProviderGenerateRequestDigest",backendName:"SharePoint"},n=this.telemetryApi.startQos(t),s.label=1;case 1:return s.trys.push([1,4,,5]),a=this.sharePointLocator.siteUrl,d=(c=de.e).postWithResponse,l=[le.t.Comments+".GetRequestDigest",{components:[le.t.Comments]},a,"/_api/contextinfo",{},{}],[4,this.generateHeaders()];case 2:return[4,d.apply(c,l.concat([s.sent(),Ie]))];case 3:return i=s.sent(),r=i[0],o=i[1],this.requestDigestCache={token:r.FormDigestValue,expiration:1e3*(Number(r.FormDigestTimeoutSeconds)-300)+Date.now()},t.backendCorrelationId=o.correlationId,t.retryCount=null===(e=o.retries)||void 0===e?void 0:e.length,n.end(),[2,this.requestDigestCache];case 4:throw u=s.sent(),f=this.generateServiceError(u),t.richCommentsErrorType="SharePointProviderGenerateRequestDigestError",t.backendCorrelationId=f.requestId,t.retryCount=f.retryCount,f.isExpected?n.endExpectedError("Warning",f):n.endUnexpectedError("Warning",f),f;case 5:return[2]}})})},e.prototype.generateHeaders=function(e){return Object(s.t)(this,void 0,void 0,function(){var t;return Object(s.i)(this,function(n){switch(n.label){case 0:return[4,this.getAccessToken("SharePointOnline")];case 1:return t=n.sent(),e?[2,{accept:"application/json",Authorization:"Bearer "+t,"user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.67 Safari/537.36 Edg/87.0.664.47","Content-Type":"application/json;charset=UTF-8","x-requestdigest":e.token}]:[2,{accept:"application/json",Authorization:"Bearer "+t,"user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.67 Safari/537.36 Edg/87.0.664.47","Content-Type":"application/json;charset=UTF-8"}]}})})},e.prototype.generateServiceError=function(e){var t,n,a,i,r,o,s,d=Object(c.t)(e);return d.isExpected||(d.statusCode&&De.has(d.statusCode)||d.message.toLowerCase().includes('"isExpected":true')||(null===(t=d.staticMessage)||void 0===t?void 0:t.toLowerCase().includes('"isExpected":true'))||(void 0===d.statusCode||d.statusCode<400)&&(d.name.toLowerCase().includes("abort")||d.name.toLowerCase().includes("network")||d.name.toLowerCase().includes("forbidden")||d.name.toLowerCase().includes("unauthorized")||d.name.toLowerCase().includes("unsupported")||d.name.toLowerCase().includes("noconnection")||d.message.toLowerCase().includes("abort")||d.message.toLowerCase().includes("network")||d.message.toLowerCase().includes("forbidden")||d.message.toLowerCase().includes("unauthorized")||d.message.toLowerCase().includes("unsupported")||d.message.toLowerCase().includes("noconnection")||(null===(n=d.staticMessage)||void 0===n?void 0:n.toLowerCase().includes("abort"))||(null===(a=d.staticMessage)||void 0===a?void 0:a.toLowerCase().includes("network"))||(null===(i=d.staticMessage)||void 0===i?void 0:i.toLowerCase().includes("forbidden"))||(null===(r=d.staticMessage)||void 0===r?void 0:r.toLowerCase().includes("unauthorized"))||(null===(o=d.staticMessage)||void 0===o?void 0:o.toLowerCase().includes("unsupported"))||(null===(s=d.staticMessage)||void 0===s?void 0:s.toLowerCase().includes("noconnection"))))&&(d.isExpected=!0),d},e}(),Ce={components:[le.t.Comments]},Oe=function(e){function t(t,n,a,i){var r=e.call(this,t,n,a)||this;return r.isHostTrusted=i,r.defaultNumPreviewReplies=10,r.defaultNumPreviewLikes=2,r.commentsPageSize="50",r.repliesPageSize="50",r.likesPageSize="200",r}return Object(s.a)(t,e),t.prototype.getAllComments=function(){return Object(s.t)(this,void 0,void 0,function(){var e,t,n,a,i,r,o,c,d,l,u;return Object(s.i)(this,function(s){switch(s.label){case 0:e={name:"CommentProviderGetAllComments",backendName:"SharePoint"},t=this.telemetryApi.startQos(e),s.label=1;case 1:return s.trys.push([1,7,,8]),[4,this.generateHeaders()];case 2:return n=s.sent(),[4,this.getAllThreads(n)];case 3:return a=s.sent(),[4,this.getAllRepliesForThreads(a,n)];case 4:return s.sent(),oe.instance.getIsCommentsLikesEnabled()?[4,this.getLikesForAllComments(a,n)]:[3,6];case 5:s.sent(),s.label=6;case 6:return i=a.filter(function(e){return""!==e.id}),r=i.map(function(e){return e.replyCount}),o=r.length>0?[r.reduce(function(e,t){return e+t}),Math.max.apply(Math,r)]:[0,0],c=o[0],d=o[1],e.richCommentsTelemetryMessage=JSON.stringify({threadCount:i.length,replyCount:c,commentCount:i.length+c,maxRepliesForThread:d}),e.richCommentsThreadNumber=""+i.length,t.end(),[2,i];case 7:throw l=s.sent(),u=this.generateServiceError(l),e.richCommentsErrorType="CommentProviderGetAllCommentsError",e.backendCorrelationId=u.requestId,u.isExpected?t.endExpectedError("Warning",u):t.endUnexpectedError("Warning",u),u;case 8:return[2]}})})},t.prototype.create=function(e,t){var n,a;return Object(s.t)(this,void 0,void 0,function(){var i,r,o,c,d,l,u,f,p,m,_,h,b,g;return Object(s.i)(this,function(s){switch(s.label){case 0:i={name:"CommentProviderCreateComments",backendName:"SharePoint"},r=this.telemetryApi.startQos(i),s.label=1;case 1:return s.trys.push([1,5,,6]),o={listId:this.sharePointLocator.listId,itemId:this.sharePointLocator.listItemId,commentId:t},c=t?Se:"/_api/web/lists(':listId')/GetItemById(':itemId')/Comments",d=this.sharePointLocator.siteUrl,[4,this.generateRequestDigest()];case 2:return l=s.sent(),_=(m=de.e).postWithResponse,h=[le.t.Comments+".create",Ce,d,c,o,e],[4,this.generateHeaders(l)];case 3:return[4,_.apply(m,h.concat([s.sent(),t?fe:pe]))];case 4:return u=s.sent(),f=u[0],p=u[1],i.richCommentsTelemetryMessage=JSON.stringify({hasMentions:0!==(null===(n=f.mentions)||void 0===n?void 0:n.length),isReply:void 0!==t}),i.backendCorrelationId=p.correlationId,i.retryCount=null===(a=p.retries)||void 0===a?void 0:a.length,r.end(),[2,f];case 5:throw b=s.sent(),g=this.generateServiceError(b),i.richCommentsErrorType="CommentProviderCreateCommentsError",i.backendCorrelationId=g.requestId,i.retryCount=g.retryCount,g.isExpected?r.endExpectedError("Warning",g):r.endUnexpectedError("Warning",g),g;case 6:return[2]}})})},t.prototype.delete=function(e){var t;return Object(s.t)(this,void 0,void 0,function(){var n,a,i,r,o,c,d,l,u,f,p;return Object(s.i)(this,function(s){switch(s.label){case 0:n={name:"CommentProviderDeleteComments",backendName:"SharePoint"},a=this.telemetryApi.startQos(n),s.label=1;case 1:if(s.trys.push([1,5,,6]),!this.isHostTrusted)throw new Error("Delete attempt from untrusted host!");return i={listId:this.sharePointLocator.listId,itemId:this.sharePointLocator.listItemId,commentId:e},r=this.sharePointLocator.siteUrl,[4,this.generateRequestDigest()];case 2:return o=s.sent(),l=(d=de.e).deleteWithResponse,u=[le.t.Comments+".delete",Ce,r,ye,i],[4,this.generateHeaders(o)];case 3:return[4,l.apply(d,u.concat([s.sent(),ve]))];case 4:return c=s.sent(),n.backendCorrelationId=c.correlationId,n.retryCount=null===(t=c.retries)||void 0===t?void 0:t.length,a.end(),[3,6];case 5:throw f=s.sent(),p=this.generateServiceError(f),n.richCommentsErrorType="CommentProviderDeleteCommentsError",n.backendCorrelationId=p.requestId,n.retryCount=p.retryCount,p.isExpected?a.endExpectedError("Warning",p):a.endUnexpectedError("Warning",p),p;case 6:return[2]}})})},t.prototype.deleteAll=function(){var e;return Object(s.t)(this,void 0,void 0,function(){var t,n,a,i,r,o,c,d,l,u,f;return Object(s.i)(this,function(s){switch(s.label){case 0:t={name:"CommentProviderDeleteAllComments",backendName:"SharePoint"},n=this.telemetryApi.startQos(t),s.label=1;case 1:if(s.trys.push([1,5,,6]),!this.isHostTrusted)throw new Error("Delete All attempt from untrusted host!");return a={listId:this.sharePointLocator.listId,itemId:this.sharePointLocator.listItemId},i=this.sharePointLocator.siteUrl,[4,this.generateRequestDigest()];case 2:return r=s.sent(),d=(c=de.e).deleteWithResponse,l=[le.t.Comments+".delete",Ce,i,"/_api/web/lists(':listId')/GetItemById(':itemId')/Comments()/DeleteAll",a],[4,this.generateHeaders(r)];case 3:return[4,d.apply(c,l.concat([s.sent(),ve]))];case 4:return o=s.sent(),t.backendCorrelationId=o.correlationId,t.retryCount=null===(e=o.retries)||void 0===e?void 0:e.length,n.end(),[3,6];case 5:throw u=s.sent(),f=this.generateServiceError(u),t.richCommentsErrorType="CommentProviderDeleteAllCommentsError",t.backendCorrelationId=f.requestId,t.retryCount=f.retryCount,f.isExpected?n.endExpectedError("Warning",f):n.endUnexpectedError("Warning",f),f;case 6:return[2]}})})},t.prototype.update=function(e,t){var n;return Object(s.t)(this,void 0,void 0,function(){var a,i,r,o,c,d,l,u,f,p,m,_;return Object(s.i)(this,function(s){switch(s.label){case 0:a={name:"CommentProviderUpdateComments",backendName:"SharePoint"},i=this.telemetryApi.startQos(a),s.label=1;case 1:if(s.trys.push([1,5,,6]),!this.isHostTrusted)throw new Error("Update attempt from untrusted host!");return r={listId:this.sharePointLocator.listId,itemId:this.sharePointLocator.listItemId,commentId:t},[4,this.generateRequestDigest()];case 2:return o=s.sent(),c=this.sharePointLocator.siteUrl,f=(u=de.e).patchWithResponse,p=[le.t.Comments+".update",Ce,c,ye,r,e],[4,this.generateHeaders(o)];case 3:return[4,f.apply(u,p.concat([s.sent(),ve]))];case 4:return(d=s.sent())[0],l=d[1],a.backendCorrelationId=l.correlationId,a.retryCount=null===(n=l.retries)||void 0===n?void 0:n.length,i.end(),[3,6];case 5:throw m=s.sent(),_=this.generateServiceError(m),a.richCommentsErrorType="CommentProviderUpdateCommentsError",a.backendCorrelationId=_.requestId,a.retryCount=_.retryCount,_.isExpected?i.endExpectedError("Warning",_):i.endUnexpectedError("Warning",_),_;case 6:return[2]}})})},t.prototype.getAreCommentsDisabled=function(){var e;return Object(s.t)(this,void 0,void 0,function(){var t,n,a,i,r,o,c,d,l,u,f,p;return Object(s.i)(this,function(s){switch(s.label){case 0:t={name:"CommentProviderGetAreCommentsDisabled",backendName:"SharePoint"},n=this.telemetryApi.startQos(t),s.label=1;case 1:return s.trys.push([1,4,,5]),a={listId:this.sharePointLocator.listId,itemId:this.sharePointLocator.listItemId},i=this.sharePointLocator.siteUrl,l=(d=de.e).getWithResponse,u=[le.t.Comments+".isCommentsDisable",Ce,i,"/_api/web/lists(':listId')/GetItemById(':itemId')/CommentsDisabled",a],[4,this.generateHeaders()];case 2:return[4,l.apply(d,u.concat([s.sent(),ge]))];case 3:return r=s.sent(),o=r[0],c=r[1],t.backendCorrelationId=c.correlationId,t.retryCount=null===(e=c.retries)||void 0===e?void 0:e.length,n.end(),[2,o];case 4:throw f=s.sent(),p=this.generateServiceError(f),t.richCommentsErrorType="CommentProviderGetAreCommentsDisabledError",t.backendCorrelationId=p.requestId,t.retryCount=p.retryCount,p.isExpected?n.endExpectedError("Warning",p):n.endUnexpectedError("Warning",p),p;case 5:return[2]}})})},t.prototype.setCommentsDisabled=function(e){var t;return Object(s.t)(this,void 0,void 0,function(){var n,a,i,r,o,c,d,l,u,f,p,m;return Object(s.i)(this,function(s){switch(s.label){case 0:n={name:"CommentProviderSetCommentsDisabled",backendName:"SharePoint"},a=this.telemetryApi.startQos(n),s.label=1;case 1:return s.trys.push([1,5,,6]),i={listId:this.sharePointLocator.listId,itemId:this.sharePointLocator.listItemId},[4,this.generateRequestDigest()];case 2:return r=s.sent(),o=this.sharePointLocator.siteUrl,u=(l=de.e).postWithResponse,f=[le.t.Comments+".isCommentsDisabled",Ce,o,"/_api/web/lists(':listId')/GetItemById(':itemId')/SetCommentsDisabled",i,{value:e}],[4,this.generateHeaders(r)];case 3:return[4,u.apply(l,f.concat([s.sent(),ve]))];case 4:return(c=s.sent())[0],d=c[1],n.backendCorrelationId=d.correlationId,n.retryCount=null===(t=d.retries)||void 0===t?void 0:t.length,a.end(),[3,6];case 5:throw p=s.sent(),m=this.generateServiceError(p),n.richCommentsErrorType="CommentProviderSetCommentsDisabledError",n.backendCorrelationId=m.requestId,n.retryCount=m.retryCount,m.isExpected?a.endExpectedError("Warning",m):a.endUnexpectedError("Warning",m),m;case 6:return[2]}})})},t.prototype.likeComment=function(e,t){var n;return Object(s.t)(this,void 0,void 0,function(){var a,i,r,o,c,d,l,u,f,p,m,_;return Object(s.i)(this,function(s){switch(s.label){case 0:a={name:"CommentProviderLikeComment",backendName:"SharePoint"},i=this.telemetryApi.startQos(a),s.label=1;case 1:return s.trys.push([1,5,,6]),r={listId:this.sharePointLocator.listId,itemId:this.sharePointLocator.listItemId,commentId:t},[4,this.generateRequestDigest()];case 2:return o=s.sent(),c=this.sharePointLocator.siteUrl,f=(u=de.e).postWithResponse,p=[le.t.Comments+".update",Ce,c,e?"/_api/web/lists(':listId')/GetItemById(':itemId')/Comments(':commentId')/like":"/_api/web/lists(':listId')/GetItemById(':itemId')/Comments(':commentId')/unlike",r,{}],[4,this.generateHeaders(o)];case 3:return[4,f.apply(u,p.concat([s.sent(),ve]))];case 4:return(d=s.sent())[0],l=d[1],a.backendCorrelationId=l.correlationId,a.retryCount=null===(n=l.retries)||void 0===n?void 0:n.length,i.end(),[3,6];case 5:throw m=s.sent(),_=this.generateServiceError(m),a.richCommentsErrorType="CommentProviderLikeCommentError",a.backendCorrelationId=_.requestId,a.retryCount=_.retryCount,_.isExpected?i.endExpectedError("Warning",_):i.endUnexpectedError("Warning",_),_;case 6:return[2]}})})},t.prototype.getInitialBatch=function(e,t,n,a,i){var r;return Object(s.t)(this,void 0,void 0,function(){var o,c,d,l,u,f,p;return Object(s.i)(this,function(s){switch(s.label){case 0:o={name:"CommentProviderGetInitialComments",backendName:"SharePoint"},c=this.telemetryApi.startQos(o),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,de.e.getWithResponse(le.t.Comments+".get",Ce,e,t,n,a,i)];case 2:return d=s.sent(),l=d[0],u=d[1],o.richCommentsThreadNumber=""+l.value.length,o.backendCorrelationId=u.correlationId,o.retryCount=null===(r=u.retries)||void 0===r?void 0:r.length,c.end(),[2,l];case 3:throw f=s.sent(),p=this.generateServiceError(f),o.richCommentsErrorType="CommentProviderGetInitialCommentsError",o.backendCorrelationId=p.requestId,o.retryCount=p.retryCount,p.isExpected?c.endExpectedError("Warning",p):c.endUnexpectedError("Warning",p),f;case 4:return[2]}})})},t.prototype.getPagedBatch=function(e,t,n){var a;return Object(s.t)(this,void 0,void 0,function(){var i,r,o,c,d,l,u;return Object(s.i)(this,function(s){switch(s.label){case 0:i={name:"CommentProviderGetPagedComments",backendName:"SharePoint"},r=this.telemetryApi.startQos(i),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,de.e.getContentWithResponse(le.t.Comments+".get",Ce,e,t,n)];case 2:return o=s.sent(),c=o[0],d=o[1],i.richCommentsThreadNumber=""+c.value.length,i.backendCorrelationId=d.correlationId,i.retryCount=null===(a=d.retries)||void 0===a?void 0:a.length,r.end(),[2,c];case 3:throw l=s.sent(),u=this.generateServiceError(l),i.richCommentsErrorType="CommentProviderGetPagedCommentsError",i.backendCorrelationId=u.requestId,i.retryCount=u.retryCount,u.isExpected?r.endExpectedError("Warning",u):r.endUnexpectedError("Warning",u),l;case 4:return[2]}})})},t.prototype.getAllThreads=function(e){return Object(s.t)(this,void 0,void 0,function(){var t,n,a,i;return Object(s.i)(this,function(r){switch(r.label){case 0:return t=[],n=this.sharePointLocator.siteUrl,a={listId:this.sharePointLocator.listId,itemId:this.sharePointLocator.listItemId,$top:this.commentsPageSize,$expand:oe.instance.getIsCommentsLikesEnabled()?"likedby,replies/likedby":"replies",$filter:"NumReplies eq ".concat(this.defaultNumPreviewReplies)},[4,this.getInitialBatch(n,"/_api/web/lists(':listId')/GetItemById(':itemId')/GetComments()",a,e,_e)];case 1:i=r.sent(),t.push.apply(t,i.value),r.label=2;case 2:return i["odata.nextLink"]?[4,this.getPagedBatch(i["odata.nextLink"],e,_e)]:[3,4];case 3:return i=r.sent(),t.push.apply(t,i.value),[3,2];case 4:return[2,t]}})})},t.prototype.getAllRepliesForThreads=function(e,t){return Object(s.t)(this,void 0,void 0,function(){var n,a=this;return Object(s.i)(this,function(i){switch(i.label){case 0:return n=this.sharePointLocator.siteUrl,[4,Promise.all(e.map(function(e){return Object(s.t)(a,void 0,void 0,function(){var a,i,r,o,c;return Object(s.i)(this,function(s){switch(s.label){case 0:if(!(e.replyCount>this.defaultNumPreviewReplies))return[3,7];s.label=1;case 1:return s.trys.push([1,6,,7]),e.replies=[],a={listId:this.sharePointLocator.listId,itemId:this.sharePointLocator.listItemId,commentId:e.id,$top:this.repliesPageSize},[4,this.getInitialBatch(n,Se,a,t,he)];case 2:i=s.sent(),e.replies.push.apply(e.replies,i.value),s.label=3;case 3:return i["odata.nextLink"]?[4,this.getPagedBatch(i["odata.nextLink"],t,he)]:[3,5];case 4:return i=s.sent(),e.replies.push.apply(e.replies,i.value),[3,3];case 5:return[3,7];case 6:return r=s.sent(),o=this.generateServiceError(r),this.telemetryApi.warn(o,{name:404===o.statusCode?"GetRepliesThreadDeleted":"GetRepliesUnknownError",isExpected:null!==(c=o.isExpected)&&void 0!==c&&c}),e.id="",[3,7];case 7:return[2]}})})}))];case 1:return i.sent(),[2]}})})},t.prototype.getLikesForAllComments=function(e,t){return Object(s.t)(this,void 0,void 0,function(){var n=this;return Object(s.i)(this,function(a){switch(a.label){case 0:return[4,Promise.all(e.map(function(e){return Object(s.t)(n,void 0,void 0,function(){var n=this;return Object(s.i)(this,function(a){switch(a.label){case 0:return e.likeCount>this.defaultNumPreviewLikes?[4,this.getLikesForComment(e,t)]:[3,2];case 1:a.sent(),a.label=2;case 2:return[4,Promise.all(e.replies.map(function(e){return Object(s.t)(n,void 0,void 0,function(){return Object(s.i)(this,function(n){switch(n.label){case 0:return e.likeCount>this.defaultNumPreviewLikes?[4,this.getLikesForComment(e,t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})})}))];case 3:return a.sent(),[2]}})})}))];case 1:return a.sent(),[2]}})})},t.prototype.getLikesForComment=function(e,t){var n;return Object(s.t)(this,void 0,void 0,function(){var a,i,r,o,c;return Object(s.i)(this,function(s){switch(s.label){case 0:a=this.sharePointLocator.siteUrl,s.label=1;case 1:return s.trys.push([1,6,,7]),e.likedBy=[],i={listId:this.sharePointLocator.listId,itemId:this.sharePointLocator.listItemId,commentId:e.id,$top:this.likesPageSize},[4,this.getInitialBatch(a,"/_api/web/lists(':listId')/GetItemById(':itemId')/Comments(':commentId')/likedBy",i,t,be)];case 2:r=s.sent(),e.likedBy.push.apply(e.likedBy,r.value),s.label=3;case 3:return r["odata.nextLink"]?[4,this.getPagedBatch(r["odata.nextLink"],t,be)]:[3,5];case 4:return r=s.sent(),e.likedBy.push.apply(e.likedBy,r.value),[3,3];case 5:return[3,7];case 6:return o=s.sent(),c=this.generateServiceError(o),this.telemetryApi.warn(c,{name:404===c.statusCode?"GetLikesThreadDeleted":"GetLikesUnknownError",isExpected:null!==(n=c.isExpected)&&void 0!==n&&n}),e.id="",[3,7];case 7:return[2]}})})},t}(xe);!function(e){e[e.None=0]="None",e[e.ViewOnly=1]="ViewOnly",e[e.Edit=2]="Edit",e[e.TotalControl=3]="TotalControl"}(ae||(ae={})),function(e){e[e.FullControl=1073741829]="FullControl",e[e.Design=1073741828]="Design",e[e.Edit=1073741830]="Edit",e[e.Contribute=1073741827]="Contribute",e[e.Read=1073741826]="Read",e[e.ViewOnly=1073741924]="ViewOnly"}(ie||(ie={}));var we={components:[le.t.Comments]},Ee=function(e){function t(t,n,a){return e.call(this,t,n,a)||this}return Object(s.a)(t,e),t.prototype.checkUserPermission=function(e){return Object(s.t)(this,void 0,void 0,function(){var t,n,a,i,r,o,c,d,l,u,f;return Object(s.i)(this,function(s){switch(s.label){case 0:t={name:"FilePermissionProviderCheckUserPermissions",backendCorrelationId:"",backendName:"SharePoint"},n=this.telemetryApi.startQos(t),s.label=1;case 1:return s.trys.push([1,5,,6]),a={listId:this.sharePointLocator.listId,itemId:this.sharePointLocator.listItemId},i=this.sharePointLocator.siteUrl,[4,this.generateRequestDigest()];case 2:return r=s.sent(),d=(c=de.e).post,l=[le.t.Comments+".CheckPermissions",we,i,"/_api/web/lists(':listId')/GetItemById(':itemId')/CheckPermissions",a,{recipients:[{alias:e.UserId}]}],[4,this.generateHeaders(r)];case 3:return[4,d.apply(c,l.concat([s.sent(),ue.e.object({value:ue.e.array(Ae)})]))];case 4:return o=s.sent(),n.end(),[2,o.value];case 5:throw u=s.sent(),f=this.generateServiceError(u),t.richCommentsErrorType="FilePermissionProviderCheckUserPermissionsError",t.backendCorrelationId=f.requestId,f.isExpected?n.endExpectedError("Warning",f.message):n.endUnexpectedError("Warning",f.message),f;case 6:return[2]}})})},t.prototype.setPermissions=function(e,t){return Object(s.t)(this,void 0,void 0,function(){var n,a,i,r,o,c,d,l,u,f,p,m,_;return Object(s.i)(this,function(s){switch(s.label){case 0:a={name:n=t?"FilePermissionProviderSetEditPermissions":"FilePermissionProviderSetViewPermissions",backendCorrelationId:"",backendName:"SharePoint"},i=this.telemetryApi.startQos(a),s.label=1;case 1:return s.trys.push([1,5,,6]),r={listId:this.sharePointLocator.listId,itemId:this.sharePointLocator.listItemId},o=this.sharePointLocator.siteUrl,[4,this.generateRequestDigest()];case 2:return c=s.sent(),d=e.map(function(e){return{Key:e.UserId,IsResolved:!1}}),l={peoplePickerInput:JSON.stringify(d),roleValue:"role:"+(t?ie.Edit:ie.Read),sendEmail:!1,emailBody:null,includeAnonymousLinkInEmail:!1,propagateAcl:!0,useSimplifiedRoles:!0},f=(u=de.e).post,p=[le.t.Comments+".SetPermissions",we,o,"/_api/web/lists(':listId')/GetItemById(':itemId')/ShareObject",r,l],[4,this.generateHeaders(c)];case 3:return[4,f.apply(u,p.concat([s.sent(),ue.e.any]))];case 4:return s.sent(),i.end(),[3,6];case 5:throw m=s.sent(),_=this.generateServiceError(m),a.richCommentsErrorType=n?"FilePermissionProviderSetEditPermissionsError":"FilePermissionProviderSetViewPermissionsError",a.backendCorrelationId=_.requestId,_.isExpected?i.endExpectedError("Warning",_.message):i.endUnexpectedError("Warning",_.message),_;case 6:return[2]}})})},t}(xe),Ae=ue.e.object({canHaveAccess:ue.e.boolean,existingAccessType:ue.e.number,hasAccess:ue.e.boolean,inputEntity:ue.e.string,isPending:ue.e.boolean,recipientDeniedReason:ue.e.number,resolvedEntity:ue.e.string,role:ue.e.number}),Le="https://graph.microsoft.com/v1.0",ke=function(){function e(e,t){this.getAccessToken=e,this.telemetryApi=t}return e.prototype.getPersonalContactInfo=function(){return Object(s.t)(this,void 0,void 0,function(){var e,t,n,a,i,r,o,c,d;return Object(s.i)(this,function(s){switch(s.label){case 0:e={name:"PeoplePickerProviderGetPersonalInfo",backendCorrelationId:"",backendName:"SharePoint"},t=this.telemetryApi.startQos(e),s.label=1;case 1:return s.trys.push([1,5,,6]),n=new URLSearchParams({$select:"displayName,givenName,surname,scoredEmailAddresses,personType,department,jobTitle,mail"}),a=fetch,i=[Le+"/me?"+n],d={method:"GET"},[4,this.generateGraphHeaders()];case 2:return[4,a.apply(void 0,i.concat([(d.headers=s.sent(),d)]))];case 3:return[4,s.sent().json()];case 4:return r=s.sent(),t.end(),[2,r];case 5:throw o=s.sent(),c=this.generateServiceError(o),e.richCommentsErrorType="PeoplePickerProviderGetPersonalInfoError",e.backendCorrelationId=c.requestId,c.isExpected?t.endExpectedError("Warning",c.message):t.endUnexpectedError("Warning",c.message),c;case 6:return[2]}})})},e.prototype.getContactsByName=function(e,t){return Object(s.t)(this,void 0,void 0,function(){var n,a,i,r,o,c,d,l,u,f;return Object(s.i)(this,function(s){switch(s.label){case 0:n={name:"PeoplePickerProviderGetContactByName",backendCorrelationId:"",backendName:"SharePoint"},a=this.telemetryApi.startQos(n),s.label=1;case 1:return s.trys.push([1,5,,6]),i={$search:'"'+e+'"',$top:t.toString(),$select:"displayName,givenName,surname,scoredEmailAddresses,personType,department,jobTitle,userPrincipalName",$filter:"personType/class ne 'Group'"},r=new URLSearchParams(i),o=fetch,c=[Le+"/me/people?"+r],f={method:"GET"},[4,this.generateGraphHeaders()];case 2:return[4,o.apply(void 0,c.concat([(f.headers=s.sent(),f)]))];case 3:return[4,s.sent().json()];case 4:return d=s.sent(),a.end(),[2,d.value];case 5:throw l=s.sent(),u=this.generateServiceError(l),n.richCommentsErrorType="PeoplePickerProviderGetContactByNameError",n.backendCorrelationId=u.requestId,u.isExpected?a.endExpectedError("Warning",u):a.endUnexpectedError("Warning",u),u;case 6:return[2]}})})},e.prototype.acquireLivePersonaPickerToken=function(){return this.getAccessToken("Loki")},e.prototype.generateGraphHeaders=function(){return Object(s.t)(this,void 0,void 0,function(){var e,t;return Object(s.i)(this,function(n){switch(n.label){case 0:return t={accept:"application/json","user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.67 Safari/537.36 Edg/87.0.664.47","Content-Type":"application/json;charset=UTF-8"},e="Bearer ",[4,this.getAccessToken("Graph")];case 1:return[2,(t.Authorization=e+n.sent(),t)]}})})},e.prototype.generateServiceError=function(e){var t=Object(c.t)(e);return t.isExpected=!(!t.statusCode||!De.has(t.statusCode)),(void 0===t.statusCode||t.statusCode<400)&&(t.name.toLowerCase().includes("abort")||t.name.toLowerCase().includes("network")||t.message.toLowerCase().includes("abort")||t.message.toLowerCase().includes("network")||t.staticMessage&&t.staticMessage.toLowerCase().includes("abort")||t.staticMessage&&t.staticMessage.toLowerCase().includes("network"))&&(t.isExpected=!0),t},e}(),Me=ue.e.object({serviceUrl:ue.e.string}),Pe=function(){function e(e,t){this.getAccessToken=e,this.telemetryApi=t,this.configuredLokiUrl=Promise.resolve("")}return e.prototype.buildProfilePictureUrl=function(e,t){return Object(s.t)(this,void 0,void 0,function(){var n,a,i,r;return Object(s.i)(this,function(o){switch(o.label){case 0:return this.areProfilePicturesEnabled()&&e.Email&&""!==e.Email?[4,this.configuredLokiUrl]:[2,""];case 1:return""===(n=o.sent())?[2,""]:(a=encodeURIComponent("smtp")+"="+encodeURIComponent(e.Email),i=encodeURIComponent("AuthToken")+"="+encodeURIComponent(t),r=encodeURIComponent("ClientType")+"="+encodeURIComponent("OfficeWebApps"),[2,n+"/api/v2/personaphoto?"+a+"&"+i+"&"+r])}})})},e.prototype.getProfilePicturesAuthToken=function(){return this.getAccessToken("Loki")},e.prototype.configure=function(e){var t=this;this.areProfilePicturesEnabled()&&(this.configuredLokiUrl=new Promise(function(n){return Object(s.t)(t,void 0,void 0,function(){var t,a,i,r,o,d,l,u;return Object(s.i)(this,function(s){switch(s.label){case 0:t={name:"ProfilePictureUrlBuilderConfigure",backendName:"Loki"},a=this.telemetryApi.startQos(t),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,de.e.getWithResponse("Comments.configureProfilePictures",{components:["Comments"]},"https://loki.delve.office.com/","/api/v1/route",{tenantid:e},this.generateHeaders(),Me)];case 2:return i=s.sent(),r=i[0],o=i[1],t.backendCorrelationId=o.correlationId,t.retryCount=null===(u=o.retries)||void 0===u?void 0:u.length,a.end(),n(r.serviceUrl),[3,4];case 3:return d=s.sent(),l=Object(c.t)(d),t.richCommentsErrorType="ProfilePictureUrlBuilderConfigureError",t.backendCorrelationId=l.requestId,t.retryCount=l.retryCount,l.isExpected?a.endExpectedError("Warning",l):a.endUnexpectedError("Warning",l),n(""),[3,4];case 4:return[2]}})})}))},e.prototype.areProfilePicturesEnabled=function(){return oe.instance.featureGatesConfiguration.PersonaIconImageForWeb===_.Enabled},e.prototype.generateHeaders=function(){return{accept:"application/json","Content-Type":"application/json;charset=UTF-8","X-ClientType":"OfficeWebApps"}},e}(),Te=n(232),Ue=function(){function e(e){this.telemetryApi=e}return e.prototype.initSharedCommentsSDK=function(e){var t={name:"InitializationPhase"},n=this.telemetryApi.startQos(t);try{Object(p.f)(e.hostCommentAPI,e.telemetrySupport,e.peopleAPI,e.viewContainerAPI,e.localizationDetails,void 0,e.featureGates,e.appColors,e.webThemeAPIProvider)}catch(e){var a=Object(c.e)(e);throw a.name="RichCommentsError",a.message=Object(l.n)(a.message),t.richCommentsErrorType="InitializationPhaseSharedCommentsInstantiationFailure",n.endUnexpectedError("Fatal",a),a}n.end()},e.prototype.initializeExtensionProviderCollection=function(){var e={name:"CommentCardExtensionProviders"},t=this.telemetryApi.startQos(e);try{var n=Object(Te.r)().getExtensions([Te.t.CommentThread],Te.n);return t.end(),n}catch(n){var a=Object(c.e)(n);throw a.name="RichCommentsError",e.richCommentsErrorType="CommentCardExtensionProvidersError",t.endUnexpectedError("Fatal",a),console.error(a),a}},e.prototype.onExtensionProviderCollectionUpdate=function(e){return Object(s.t)(this,void 0,void 0,function(){var t,n,a,i,r,o,d;return Object(s.i)(this,function(s){switch(s.label){case 0:if(0===e.providers.length)return[2];if(t={name:"CommentCardHostableComponent"},n=this.telemetryApi.startQos(t),!(a=e.providers.find(function(e){return Object(Te.s)(e)}))||!Object(Te.s)(a))return t.name="CommentCardHostableComponentExtensionUndefined",n.end(),[2];switch((i=a.getExtension()).priority){case Te.a.Disabled:return[3,1];case Te.a.Primary:case Te.a.Secondary:return[3,2]}return[3,6];case 1:return t.name="CommentCardHostableComponentPriorityDisabled",n.end(),[3,7];case 2:return s.trys.push([2,4,,5]),[4,Object(I.n)().getComponent(i.componentKey)];case 3:return r=s.sent().component,this.commentCardHeight=i.componentDimensions&&i.componentDimensions.height,n.end(),[2,r];case 4:return o=s.sent(),(d=Object(c.e)(o)).name="RichCommentsError",t.richCommentsErrorType="CommentCardHostableComponentError",n.endUnexpectedError("Fatal",d),console.error(d),[3,5];case 5:return[3,7];case 6:return t.name="CommentCardHostableComponentPriorityUndefined",n.end(),[3,7];case 7:return[2]}})})},e}(),Fe=function(){function e(e){var t=this;this._comments=e,this._threads=this._comments.filter(function(e){return""===e.parentId}),this._threadReplyCount=new Map,this._threads.forEach(function(e){var n=t._comments.filter(function(t){return t.parentId===e.commentId}).length;t._threadReplyCount.set(e.commentId,n)})}return Object.defineProperty(e.prototype,"getComments",{get:function(){return this._comments},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"getThreads",{get:function(){return this._threads},enumerable:!1,configurable:!0}),e.prototype.findComment=function(e){return this.getCommentByIdOrIndex(e)},e.prototype.findThreadIndex=function(e){return this._comments.filter(p.u).findIndex(function(t){return t.commentId===e})},e.prototype.getThreadReplyCount=function(e){return this._threadReplyCount.get(e)||0},e.prototype.insertComment=function(e,t,n){var a=n;if(Object(p.u)(e)){if(void 0!==a){var i=this.getThreadRoot(a);a=i&&i.index}if(void 0===a)a=0,this._threads.unshift(e);else{var r=this._comments[a],o=this._threads.findIndex(function(e){return e.commentId===r.commentId});this._threads.splice(o,0,e)}this._threadReplyCount.set(e.commentId,0)}else{var s=this.indexInfoOf(e.parentId);if(!s)throw new Error("Parent thread not found");if(void 0!==a){var c=this.getCommentByIdOrIndex(a);c&&c.parentId===e.parentId||(a=void 0)}void 0===a&&(a=s.index+(s.children?s.children.length+1:0))}this._comments.splice(a,0,e);var d=this._threadReplyCount.get(e.parentId);return d&&this._threadReplyCount.set(e.parentId,d+1),[{index:a,model:e,type:p.t.Insert,tempId:t}]},e.prototype.update=function(e,t){var n=this.indexOf(e),a=this.getCommentByIdOrIndex(n);if(n<0||void 0===a)throw new Error("Comment not found");return a.commentBody=t,this._comments[n]=a,[{index:n,model:a,type:p.t.Modify}]},e.prototype.delete=function(e){var t=this,n=this.indexInfoOf(e);if(!n)return[];var a=[];if(n.children&&n.children.length>0&&a.push.apply(a,n.children.map(function(e){return{model:{commentId:e.commentId},type:p.t.Delete,index:n.index+1}})),a.push({model:{commentId:e},index:n.index,type:p.t.Delete}),""===this._comments[n.index].parentId){var i=this._threads.findIndex(function(e){return e.commentId===t._comments[n.index].commentId});this._threads.splice(i,1),this._threadReplyCount.delete(e)}else{var r=this._threadReplyCount.get(this._comments[n.index].parentId);r&&this._threadReplyCount.set(this._comments[n.index].parentId,r-1)}return this._comments.splice(n.index,a.length),a},e.prototype.deleteAll=function(){var e=this,t=this._threads.map(function(e){return e.commentId}).map(function(t){return e.delete(t)});return[].concat.apply([],t)},e.prototype.indexInfoOf=function(e){var t=this.indexOf(e),n=this.getCommentByIdOrIndex(t);if(!(t<0)&&n)return{index:t,item:n,children:Object(p.u)(n)&&this._comments.filter(function(t){return t.parentId===e})}},e.prototype.getThreadRoot=function(e){var t=this.getCommentByIdOrIndex(e);if(t)return Object(p.u)(t)?this.indexInfoOf(t.commentId):this.indexInfoOf(t.parentId)},e.prototype.indexOf=function(e){return this._comments.findIndex(function(t){return t.commentId===e})},e.prototype.getCommentByIdOrIndex=function(e){var t;return"string"==typeof e?(t=this.indexOf(e),this._comments[t]):(t=e)<0?void 0:this._comments[t]},e}(),He=function(){function e(e,t,n,a){this.commentProvider=e,this.userContext=t,this.officeDeltaTranslator=n,this.officeDeltaTranslator=n;var i=p.a.EditRestricted,r=p.a.EditRestricted|p.a.DeleteRestricted;this.authorCommentFlags=a?p.a.None:r,this.nonAuthorCommentFlags=a&&t.UserCanWrite?i:r}return e.prototype.loadComments=function(){return Object(s.t)(this,void 0,void 0,function(){var e,t,n=this;return Object(s.i)(this,function(a){switch(a.label){case 0:return[4,this.commentProvider.getAllComments()];case 1:return e=a.sent(),t=e.map(function(e){var t,a={commentId:e.id,commentBody:n.officeDeltaTranslator.translateToODeltaFormat(e),date:new Date(e.createdDate),parentId:"",commentFlags:n.userContext.Email===e.author.email?n.authorCommentFlags:n.nonAuthorCommentFlags,author:{authorContextId:e.author.email,UserId:e.author.email,Provider:"O365",Email:e.author.email,DisplayName:e.author.name,IsCurrentUser:n.userContext.Email===e.author.email},usersByReactionType:(t={},t[p.c.Like]=e.likedBy?e.likedBy.map(function(e){return{UserId:e.email,Provider:"O365",Email:e.email,DisplayName:e.name,IsCurrentUser:n.userContext.Email===e.email}}):[],t)};e.replies=e.replies.reverse();var i=e.replies.map(function(e){var t;return{commentId:e.id,commentBody:n.officeDeltaTranslator.translateToODeltaFormat(e),date:new Date(e.createdDate),parentId:e.parentId,commentFlags:n.userContext.Email===e.author.email?n.authorCommentFlags:n.nonAuthorCommentFlags,author:{authorContextId:e.author.email,UserId:e.author.email,Provider:"O365",Email:e.author.email,DisplayName:e.author.name,IsCurrentUser:n.userContext.Email===e.author.email},usersByReactionType:(t={},t[p.c.Like]=e.likedBy?e.likedBy.map(function(e){return{UserId:e.email,Provider:"O365",Email:e.email,DisplayName:e.name,IsCurrentUser:n.userContext.Email===e.email}}):[],t)}});return Object(s.c)([a],i,!0)}),this.commentListView=new Fe([].concat.apply([],t)),[2]}})})},e.prototype.unloadComments=function(){return Object(s.t)(this,void 0,void 0,function(){return Object(s.i)(this,function(e){return this.commentListView=new Fe([]),[2]})})},e.prototype.getCommentModelList=function(){return this.commentListView},e.prototype.getThreadModelList=function(){return this.commentListView?this.commentListView.getThreads:[]},e.prototype.generateNewDraftId=function(){return(this.commentListView.getComments.reduce(function(e,t){var n=parseInt(t.commentId,10);return n>e?n:e},0)+1).toString()},e.prototype.getThreadReplyCount=function(e){return this.commentListView?this.commentListView.getThreadReplyCount(e):0},e.prototype.insertComment=function(e,t){return Object(s.t)(this,void 0,void 0,function(){var n,a,i,r,o;return Object(s.i)(this,function(s){switch(s.label){case 0:if(n=this.officeDeltaTranslator.translateToSharePointFormat(e.commentBody),!e.parentId)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.commentProvider.create(n,e.parentId)];case 2:return i=s.sent(),a={commentId:i.id,commentBody:this.officeDeltaTranslator.translateToODeltaFormat(i),date:new Date(i.createdDate),parentId:i.parentId,commentFlags:this.userContext.Email===i.author.email?this.authorCommentFlags:this.nonAuthorCommentFlags,author:{authorContextId:i.author.email,UserId:i.author.email,Provider:"O365",Email:i.author.email,DisplayName:i.author.name,IsCurrentUser:this.userContext.Email===i.author.email}},[3,4];case 3:throw 404===(r=s.sent()).statusCode&&this.commentListView.delete(e.parentId),r;case 4:return[3,7];case 5:return[4,this.commentProvider.create(n)];case 6:o=s.sent(),a={commentId:o.id,commentBody:this.officeDeltaTranslator.translateToODeltaFormat(o),date:new Date(o.createdDate),parentId:"",commentFlags:this.userContext.Email===o.author.email?this.authorCommentFlags:this.nonAuthorCommentFlags,author:{authorContextId:o.author.email,UserId:o.author.email,Provider:"O365",Email:o.author.email,DisplayName:o.author.name,IsCurrentUser:this.userContext.Email===o.author.email}},s.label=7;case 7:return[2,this.commentListView.insertComment(a,e.commentId,t)]}})})},e.prototype.updateComment=function(e,t){return Object(s.t)(this,void 0,void 0,function(){var n,a;return Object(s.i)(this,function(i){switch(i.label){case 0:n=this.officeDeltaTranslator.translateToSharePointFormat(t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.commentProvider.update(n,e)];case 2:return i.sent(),[3,4];case 3:throw 404===(a=i.sent()).statusCode&&this.commentListView.delete(e),a;case 4:return[2,this.commentListView.update(e,t)]}})})},e.prototype.deleteComment=function(e){return Object(s.t)(this,void 0,void 0,function(){var t;return Object(s.i)(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.commentProvider.delete(e)];case 1:return n.sent(),[3,3];case 2:throw 404===(t=n.sent()).statusCode&&this.commentListView.delete(e),t;case 3:return[2,this.commentListView.delete(e)]}})})},e.prototype.deleteAllComments=function(){return Object(s.t)(this,void 0,void 0,function(){return Object(s.i)(this,function(e){switch(e.label){case 0:return[4,this.commentProvider.deleteAll()];case 1:return e.sent(),[2,this.commentListView.deleteAll()]}})})},e.prototype.enableComments=function(){return Object(s.t)(this,void 0,void 0,function(){return Object(s.i)(this,function(e){switch(e.label){case 0:return[4,this.commentProvider.setCommentsDisabled(!1)];case 1:return e.sent(),[2]}})})},e.prototype.disableComments=function(){return Object(s.t)(this,void 0,void 0,function(){return Object(s.i)(this,function(e){switch(e.label){case 0:return[4,this.commentProvider.setCommentsDisabled(!0)];case 1:return e.sent(),[2]}})})},e.prototype.getAreCommentsDisabled=function(){return Object(s.t)(this,void 0,void 0,function(){return Object(s.i)(this,function(e){switch(e.label){case 0:return[4,this.commentProvider.getAreCommentsDisabled()];case 1:return[2,e.sent().value]}})})},e.prototype.likeComment=function(e,t,n){var a;return Object(s.t)(this,void 0,void 0,function(){var i,r,o,c;return Object(s.i)(this,function(s){switch(s.label){case 0:return i=null!==(a=t.usersByReactionType)&&void 0!==a?a:((c={})[p.c.Like]=[],c),r={UserId:this.userContext.Id,Provider:this.userContext.Provider,Email:this.userContext.Email,DisplayName:this.userContext.DisplayName,IsCurrentUser:this.userContext.IsCurrentUser},n?i[p.c.Like].push(r):(o=i[p.c.Like],i[p.c.Like]=o.filter(function(e){return!(e.UserId===r.UserId&&e.Provider===r.Provider)})),t.usersByReactionType=i,[4,this.commentProvider.likeComment(n,t.commentId)];case 1:return s.sent(),[2,{index:e,model:t,type:p.t.Modify}]}})})},e}(),Re=n(18),Ne=n(1360),Be=n(1681),je=["#d47800","#3834d1","#981788","#058249","#8c00e3","#1050ca","#878303","#0b6f98","#2c26a4","#ed6b4f","#b339c2","#393939","#0b6a0b","#b86487","#1c0b75","#74757a","#912e5c","#7e7969","#705b00","#2e568e"],Ve=function(){function e(e,t,n,a,i,r,o,s,c,d){void 0===d&&(d=z.t.GetContactsForMentions),this.sharePointLocator=e,this.getAccessToken=t,this.localization=n,this.filePermissionProvider=a,this.peoplePickerProvider=i,this.profilePictureUrlBuilder=r,this.showModal=o,this.telemetryApi=s,this.currentPlaybackTimeInSeconds=c,this.capabilities=d}return e.prototype.checkUserAccess=function(e){return Object(s.t)(this,void 0,void 0,function(){var t,n;return Object(s.i)(this,function(a){switch(a.label){case 0:return[4,this.filePermissionProvider.checkUserPermission(e)];case 1:return t=a.sent(),(n=t.pop())?[2,{Id:e.UserId,Provider:e.Provider,UserCanReview:n.canHaveAccess?n.hasAccess:void 0,UserCanWrite:n.role>=ae.Edit}]:[2,{Id:e.UserId,Provider:e.Provider,UserCanReview:void 0,UserCanWrite:!1}]}})})},e.prototype.grantUsersAccess=function(e){return Object(s.t)(this,void 0,void 0,function(){var t,n,a,i,r,o,c,d;return Object(s.i)(this,function(s){switch(s.label){case 0:t=[],n=[],s.label=1;case 1:s.trys.push([1,9,,10]),a=0,i=e,s.label=2;case 2:return a<i.length?(r=i[a],[4,this.checkUserAccess(r)]):[3,5];case 3:void 0===(o=s.sent()).UserCanReview?t.push(r):o.UserCanReview||n.push(r),s.label=4;case 4:return a++,[3,2];case 5:return d={},t.length>0||n.length>0?[4,this.openAtMentionsShareDialog(t,n)]:[3,7];case 6:return c=s.sent(),[3,8];case 7:c=z.e.Success,s.label=8;case 8:return[2,(d.OperationResult=c,d)];case 9:return s.sent(),[2,{OperationResult:z.e.UnknownError}];case 10:return[2]}})})},e.prototype.getContactsForMentions=function(e,t,n){return Object(s.t)(this,void 0,void 0,function(){return Object(s.i)(this,function(n){switch(n.label){case 0:return e?[4,this.peoplePickerProvider.getContactsByName(e,t)]:[2,[]];case 1:return[2,n.sent().map(function(e){return{Id:e.mail,Provider:"O365",Email:e.mail,DisplayName:e.displayName,GivenName:e.givenName,Surname:e.surname,Title:e.jobTitle}})]}})})},e.prototype.getAuthToken=function(e){return this.peoplePickerProvider.acquireLivePersonaPickerToken()},e.prototype.getPersonaIconPropertiesArray=function(e){return Object(s.t)(this,void 0,void 0,function(){var t,n,a,i,r,o,c,d;return Object(s.i)(this,function(s){switch(s.label){case 0:return 0===e.length?[2,[]]:(t=[],[4,this.profilePictureUrlBuilder.getProfilePicturesAuthToken()]);case 1:n=s.sent(),a=0,i=e,s.label=2;case 2:return a<i.length?(r=i[a],c=(o=t).push,d={authorName:r.DisplayName?r.DisplayName:"",authorID:r.UserId},[4,this.profilePictureUrlBuilder.buildProfilePictureUrl(r,n)]):[3,5];case 3:c.apply(o,[(d.authorImageURL=s.sent(),d.authorColor=this.getColor(r.DisplayName?r.DisplayName:""),d)]),s.label=4;case 4:return a++,[3,2];case 5:return[2,t]}})})},e.prototype.contextChange=function(e,t){this.filePermissionProvider=e,this.peoplePickerProvider=t},e.prototype.getCommentAuthor=function(e,t){return Object(s.t)(this,void 0,void 0,function(){var n,a;return Object(s.i)(this,function(i){switch(i.label){case 0:return e&&"sandboxDisplayName"!==e.displayName&&"sandboxEmail"!==e.userEmail?[3,2]:[4,this.peoplePickerProvider.getPersonalContactInfo()];case 1:return a=i.sent(),n={UserId:a.mail,Provider:"O365",Email:a.mail,DisplayName:a.displayName,IsCurrentUser:!0,Id:a.mail,UserCanWrite:t},[3,3];case 2:n={UserId:e.userEmail,Provider:"O365",Email:e.userEmail,DisplayName:e.displayName,IsCurrentUser:!0,Id:e.userEmail,UserCanWrite:t},i.label=3;case 3:return[2,n]}})})},e.prototype.openAtMentionsShareDialog=function(e,t){var n,a;return Object(s.t)(this,void 0,void 0,function(){var i,r,o,c,d,l,u,f,p,m,_,h,b,g,v=this;return Object(s.i)(this,function(y){switch(y.label){case 0:i=oe.instance.userCanWrite,r=new Re.e,o=i?z.e.DialogCanceled:z.e.FailedSilently,c=!1,d=function(){var e;c=!0;var t=i?"ClickShareAndNotifyAtMentionsShareDialog":"ClickOkAtMentionsShareDialog";v.telemetryApi.userAction({name:t,playbackTimeSec:null!==(e=v.currentPlaybackTimeInSeconds.value)&&void 0!==e?e:-1,actionType:"Unknown"}),i&&(o=z.e.Success)},l=function(){var e;c||v.telemetryApi.userAction({name:"ClickCancelAtMentionsShareDialog",playbackTimeSec:null!==(e=v.currentPlaybackTimeInSeconds.value)&&void 0!==e?e:-1,actionType:"Unknown"}),r.notify(o)},u=i?e.length>0?e:t:Object(s.c)(Object(s.c)([],e,!0),t,!0),f=u.map(function(e){return e.UserId}),p={name:"TimeToInteractionResponse",resultVariant:"AtMentionsShareDialogLoaded",backendName:"SharePoint"},m={timeToLoadShareDialogQos:this.telemetryApi.startQos(p)},y.label=1;case 1:return y.trys.push([1,4,,5]),[4,this.getAccessToken("SharePointOnline")];case 2:return _=y.sent(),h={mode:Ne.e.atMention,sharePointLocator:this.sharePointLocator,accessToken:_,telemetryApi:this.telemetryApi,localization:this.localization,showModal:this.showModal,shareQos:m,defaultRecipients:f,onDismiss:l,onGrantAccess:d},[4,Object(Be.e)(h)];case 3:return y.sent(),[3,5];case 4:return b=y.sent(),g=this.generateServiceError(b),p.richCommentsErrorType="PeopleServiceOpenAtMentionsShareDialogError",g.isExpected?null===(n=m.timeToLoadShareDialogQos)||void 0===n||n.endExpectedError("Warning",g):null===(a=m.timeToLoadShareDialogQos)||void 0===a||a.endUnexpectedError("Warning",g),m.timeToLoadShareDialogQos=void 0,[2,Promise.resolve(z.e.UnknownError)];case 5:return[4,new Promise(function(e){r.subscribe(e,{unregisterOnFirstCall:!0})})];case 6:return[2,y.sent()]}})})},e.prototype.getColor=function(e){for(var t=0,n=0;n<e.length;n++)t+=e.charCodeAt(n);return je[t%je.length]},e.prototype.generateServiceError=function(e){var t,n,a,i,r,o,s,d=Object(c.t)(e);return d.isExpected||(d.statusCode&&De.has(d.statusCode)||d.message.toLowerCase().includes('"isExpected":true')||(null===(t=d.staticMessage)||void 0===t?void 0:t.toLowerCase().includes('"isExpected":true'))||(void 0===d.statusCode||d.statusCode<400)&&(d.name.toLowerCase().includes("abort")||d.name.toLowerCase().includes("network")||d.name.toLowerCase().includes("forbidden")||d.name.toLowerCase().includes("unauthorized")||d.name.toLowerCase().includes("unsupported")||d.name.toLowerCase().includes("noconnection")||d.message.toLowerCase().includes("abort")||d.message.toLowerCase().includes("network")||d.message.toLowerCase().includes("forbidden")||d.message.toLowerCase().includes("unauthorized")||d.message.toLowerCase().includes("unsupported")||d.message.toLowerCase().includes("noconnection")||(null===(n=d.staticMessage)||void 0===n?void 0:n.toLowerCase().includes("abort"))||(null===(a=d.staticMessage)||void 0===a?void 0:a.toLowerCase().includes("network"))||(null===(i=d.staticMessage)||void 0===i?void 0:i.toLowerCase().includes("forbidden"))||(null===(r=d.staticMessage)||void 0===r?void 0:r.toLowerCase().includes("unauthorized"))||(null===(o=d.staticMessage)||void 0===o?void 0:o.toLowerCase().includes("unsupported"))||(null===(s=d.staticMessage)||void 0===s?void 0:s.toLowerCase().includes("noconnection"))))&&(d.isExpected=!0),d},e}(),ze=function(){var e=Object(h.Y)();return e?{shade30:e.palette.themeDarker,shade20:e.palette.themeDark,shade10:e.palette.themeDarkAlt,primary:e.palette.themePrimary,tint10:e.palette.themeSecondary,tint20:e.palette.themeLight,tint30:e.palette.themeLighter,tint40:e.palette.themeLight}:{shade30:"#730e2b",shade20:"#8c1134",shade10:"#a81640",primary:"#BC1948",tint10:"#cc2f5c",tint20:"#d13b66",tint30:"#de7392",tint40:"#de8ea5"}},Ge=n(2155),Ke=function(){function e(){}return e.getDetails=function(e){return{isRightToLeft:Object(Ge.e)(),uiCulture:e,dataCulture:e}},e.loadSharedCommentsStrings=function(t,n){return Object(s.t)(this,void 0,void 0,function(){var a,i,r;return Object(s.i)(this,function(o){switch(o.label){case 0:return t&&!e.isDefaultLocale(t)?[3,2]:(a=window,[4,e.loadCommentsLangResource(e.getDefaultLocale(),n,!0)]);case 1:return a.CommentPaneStrings=o.sent(),[3,6];case 2:return o.trys.push([2,4,,6]),i=window,[4,e.loadCommentsLangResource(t,n)];case 3:return i.CommentPaneStrings=o.sent(),[3,6];case 4:return o.sent(),r=window,[4,e.loadCommentsLangResource(e.getDefaultLocale(),n,!0)];case 5:return r.CommentPaneStrings=o.sent(),[3,6];case 6:return[2]}})})},e.loadCommentsLangResource=function(t,a,i){return Object(s.t)(this,void 0,void 0,function(){var r,o,d,u,f,p,m;return Object(s.i)(this,function(s){switch(s.label){case 0:r=e.formatLocaleCasing(t),o={name:"SharedCommentsStringsLoad",richCommentsLocaleLanguage:t},d=a.startQos(o),u=0,s.label=1;case 1:if(!(u<=3))return[3,9];s.label=2;case 2:return s.trys.push([2,4,,8]),[4,n(2376)("./".concat(r,"/comment-pane-strings.json")).then(function(e){return e.default})];case 3:return f=s.sent(),o.retryCount=u,d.end(),[2,f];case 4:if(p=s.sent(),u++,i&&!(u>3))return[3,5];throw(m=Object(c.e)(p)).name="RichCommentsError",e.isDefaultLocale(r)?o.richCommentsErrorType="DefaultLocaleStringsLoadError":o.richCommentsErrorType="UserLocaleStringsLoadError",o.retryCount=u,d.endUnexpectedError("Fatal",m),m;case 5:return[4,e.delay(200*Math.pow(2,u))];case 6:s.sent(),s.label=7;case 7:return[3,8];case 8:return[3,1];case 9:throw new Error(Object(l.n)("Rich Comments LocalizationUtils: Unexpected code path, we should have never got here."))}})})},e.isDefaultLocale=function(t){return t.toLocaleLowerCase()===e.getDefaultLocale().toLocaleLowerCase()},e.getDefaultLocale=function(){return"en-US"},e.formatLocaleCasing=function(e){var t=e.split("-");if(t[0]=t[0].toLowerCase(),t[t.length-1]=t[t.length-1].toUpperCase(),3===t.length){var n=t[1];t[1]=n[0].toUpperCase()+n.slice(1).toLowerCase()}return t.join("-")},e.delay=function(e){return new Promise(function(t){setTimeout(t,e)})},e}();function We(e,t,n){var a,i;return Object(s.t)(this,void 0,void 0,function(){var r,o,d,u,f,p,m,_,h,b,g,v,y,S,D,I,x,C,O,w,E,A;return Object(s.i)(this,function(s){switch(s.label){case 0:r=e.localization.locale.value?e.localization.locale.value:"en-US",o={siteUrl:e.sharePointLocator.siteUrl,listId:e.sharePointLocator.listId,listItemId:e.sharePointLocator.listItemId},d={name:"InstantiationPhase",richCommentsOldSessionId:"",richCommentsUserPermission:"UserHasReadPermissions",richCommentsPeoplePickerService:"None"},u=e.telemetryApi.startQos(d),f=oe.instance,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,e.lokiTokenAvailabilityCheck];case 2:return s.sent()&&(f.isLokiServiceEnabled=!0,d.richCommentsPeoplePickerService="MicrosoftLoki",t.profilePictureUrlBuilder.configure(null!==(i=null===(a=e.metadata.userContext.value)||void 0===a?void 0:a.tenantId)&&void 0!==i?i:"")),[3,4];case 3:return s.sent(),f.isLokiServiceEnabled=!1,e.telemetryApi.warn(Object(l.n)("Could not fetch Loki token"),{name:"LokiTokenUnavailable",isExpected:!1}),[3,4];case 4:if(p="EditTrustedHost"===e.metadata.userPermissions.value||"EditUntrustedHost"===e.metadata.userPermissions.value,m="EditTrustedHost"===e.metadata.userPermissions.value||"NoEditTrustedHost"===e.metadata.userPermissions.value,_=!p&&!0===e.commentsOptions.viewersCanCommentDisabledOnTenant,n)return[3,10];s.label=5;case 5:return s.trys.push([5,7,,8]),[4,Ke.loadSharedCommentsStrings(r,e.telemetryApi)];case 6:return s.sent(),[3,8];case 7:throw h=s.sent(),(b=Object(c.e)(h)).message=Object(l.n)("Failed to fetch and load SharedComments strings"),u.endUnexpectedError("Fatal",b),b;case 8:return g=new ce(e.metadata.telemetryContext.onePlayerContext.playbackSessionId,e.onePlayerVersion,e.telemetryApi),[4,(D=new Ve(e.sharePointLocator,e.metadata.getAccessToken,e.localization,t.filePermissionProvider,t.peoplePickerProvider,t.profilePictureUrlBuilder,e.showModal,e.telemetryApi,e.currentPlaybackTimeInSeconds,z.t.GetContactsForMentions|z.t.GetAuthToken)).getCommentAuthor(e.metadata.userContext.value,p)];case 9:return I=s.sent(),x=new se(I.Email),C=new He(t.commentProvider,I,x,m),O=f.getCommentControllerSettings(_),w=f.getClientHostCommentAPISettings(I),y=new J(C,O,w,e.telemetryApi,e.currentPlaybackTimeInSeconds,x),S=new $,v=Ke.getDetails(r),E=new ee,A={viewContainerAPI:S,paneVisible:G.e.Visible,hostCommentAPI:y,peopleAPI:D,telemetryUtils:g,localizationDetails:v,appColors:ze(),featureGates:f.featureGatesConfiguration,sharePointLocator:o,isSharedCommentsInitialized:!1,userCanWrite:f.userCanWrite,isHostTrusted:f.isHostTrusted,sharedCommentsProvider:t.sharedCommentsProvider,webThemeAPIProvider:E,isReadOnly:_},d.richCommentsUserPermission=f.userCanWrite?"UserHasWritePermissions":"UserHasReadPermissions",u.end(),[2,A];case 10:return y=n.hostCommentAPI,S=n.viewContainerAPI,D=n.peopleAPI,d.richCommentsOldSessionId=n.telemetryUtils.sessionId,n.telemetryUtils.sessionId=e.metadata.telemetryContext.onePlayerContext.playbackSessionId,n.telemetryUtils.telemetryApi=e.telemetryApi,D.contextChange(t.filePermissionProvider,t.peoplePickerProvider),[4,D.getCommentAuthor(e.metadata.userContext.value,"EditTrustedHost"===e.metadata.userPermissions.value||"EditUntrustedHost"===e.metadata.userPermissions.value)];case 11:return I=s.sent(),x=new se(I.Email),C=new He(t.commentProvider,I,x,m),O=f.getCommentControllerSettings(_),w=f.getClientHostCommentAPISettings(I),y.contextChange(C,O,w,e.telemetryApi,x),E=new ee,A={viewContainerAPI:S,paneVisible:G.e.Visible,hostCommentAPI:y,peopleAPI:n.peopleAPI,telemetryUtils:n.telemetryUtils,localizationDetails:n.localizationDetails,appColors:ze(),featureGates:f.featureGatesConfiguration,sharePointLocator:o,isSharedCommentsInitialized:!0,userCanWrite:f.userCanWrite,isHostTrusted:f.isHostTrusted,sharedCommentsProvider:t.sharedCommentsProvider,webThemeAPIProvider:E,isReadOnly:_},d.richCommentsUserPermission=f.userCanWrite?"UserHasWritePermissions":"UserHasReadPermissions",u.end(),[2,A]}})})}var qe=function(e){return Object(s.t)(void 0,void 0,void 0,function(){var t,n,a,i,r,o;return Object(s.i)(this,function(s){switch(s.label){case 0:t={name:"TimeToLoad",resultVariant:"RichCommentsLoaded",richCommentsTelemetryMessage:JSON.stringify({areCommentsEnabled:e.commentsOptions.areCommentsEnabled,viewersCanComment:!e.commentsOptions.viewersCanCommentDisabledOnTenant,deeplinkPresent:void 0!==e.commentsOptions.targetCommentId,userLocale:e.localization.locale.value,userCanEdit:e.metadata.userPermissions.value.startsWith("Edit")})},n=e.telemetryApi.startQos(t),s.label=1;case 1:return s.trys.push([1,3,,4]),a=function(e){var t=e.telemetryApi.startQos({name:"ProviderInstantiationPhase"}),n=oe.instance,a="EditTrustedHost"===e.metadata.userPermissions.value||"EditUntrustedHost"===e.metadata.userPermissions.value,i="EditTrustedHost"===e.metadata.userPermissions.value||"NoEditTrustedHost"===e.metadata.userPermissions.value;n.initialize(e.settingsStore,a,i);var r=new Ee(e.sharePointLocator,e.metadata.getAccessToken,e.telemetryApi),o=new ke(e.metadata.getAccessToken,e.telemetryApi),s=new Oe(e.sharePointLocator,e.metadata.getAccessToken,e.telemetryApi,i),c=new Ue(e.telemetryApi),d=new Pe(e.metadata.getAccessToken,e.telemetryApi);return t.end(),{filePermissionProvider:r,peoplePickerProvider:o,commentProvider:s,sharedCommentsProvider:c,profilePictureUrlBuilder:d}}(e),[4,We(e,a,window.CommentIntegrationPoints)];case 2:return i=s.sent(),window.CommentIntegrationPoints=i,(d=i).isSharedCommentsInitialized||d.sharedCommentsProvider.initSharedCommentsSDK({hostCommentAPI:d.hostCommentAPI,telemetrySupport:d.telemetryUtils.getTelemetrySupport(),peopleAPI:d.peopleAPI,viewContainerAPI:d.viewContainerAPI,localizationDetails:d.localizationDetails,featureGates:d.featureGates,appColors:d.appColors,webThemeAPIProvider:d.webThemeAPIProvider}),n.end(),[2,i];case 3:throw r=s.sent(),(o=Object(c.t)(r)).name="RichCommentsError",o.message=Object(l.n)(o.message),t.richCommentsErrorType="CommentPaneControllerPropsPromiseError",o.isExpected?n.endExpectedError("Fatal",o):n.endUnexpectedError("Fatal",o),o;case 4:return[2]}var d})})},Qe={isCommentsAtMentionsPayloadEnabled:{defaultValue:!1,type:"boolean",friendlyName:"RichComments-AtMentionsPayloadEnabled",featureFlagClassification:"MinorFeature"},isCommentsAtMentionsNewFormatEnabled:{defaultValue:!1,type:"boolean",friendlyName:"RichComments-AtMentionsFormatEnabled",featureFlagClassification:"MinorFeature"},areProfilePicturesForCommentCardsEnabled:{defaultValue:!0,type:"boolean",friendlyName:"RichComments-ProfilePicturesEnabled",featureFlagClassification:"MinorFeature"},isCommentsLikesEnabled:{defaultValue:!1,type:"boolean",friendlyName:"RichComments-LikesEnabled",featureFlagClassification:"MinorFeature"}};Object(s.e)({31744:{defaultValue:!1,type:"boolean",friendlyName:"RichComments-ViewerCommentsOnMedia"},isCommentsTimeStampsEnabled:{defaultValue:!1,type:"boolean",friendlyName:"RichComments-TimeStamps"}},Qe)}}]);